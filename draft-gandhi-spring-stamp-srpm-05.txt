



SPRING Working Group                                      R. Gandhi, Ed.
Internet-Draft                                               C. Filsfils
Intended status: Standards Track                     Cisco Systems, Inc.
Expires: July 29, 2021                                          D. Voyer
                                                             Bell Canada
                                                                 M. Chen
                                                                  Huawei
                                                             B. Janssens
                                                                    Colt
                                                        January 25, 2021


 Performance Measurement Using Simple TWAMP (STAMP) for Segment Routing
                                Networks
                   draft-gandhi-spring-stamp-srpm-05

Abstract

   Segment Routing (SR) leverages the source routing paradigm.  SR is
   applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6
   (SRv6) data planes.  This document describes procedures for
   Performance Measurement (PM) in SR networks using the mechanisms
   defined in RFC 8762 (Simple Two-Way Active Measurement Protocol
   (STAMP)) and its optional extensions defined in RFC 8972.  The
   procedure described is applicable to SR-MPLS and SRv6 data planes and
   is used for both links and end-to-end SR paths including SR Policies.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on July 29, 2021.








Gandhi, et al.            Expires July 29, 2021                 [Page 1]

Internet-Draft       Using STAMP for Segment Routing        January 2021


Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   3
     2.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
     2.2.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   3
     2.3.  Reference Topology  . . . . . . . . . . . . . . . . . . .   4
   3.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . . .   5
     3.1.  Example Provisioning Model  . . . . . . . . . . . . . . .   5
   4.  Delay Measurement for Links and SR Paths  . . . . . . . . . .   6
     4.1.  Session-Sender Test Packet  . . . . . . . . . . . . . . .   6
       4.1.1.  Session-Sender Test Packet for links  . . . . . . . .   7
       4.1.2.  Session-Sender Test Packet for SR Policy  . . . . . .   7
     4.2.  Session-Reflector Test Packet . . . . . . . . . . . . . .   9
       4.2.1.  One-way Measurement Mode  . . . . . . . . . . . . . .  10
       4.2.2.  Two-way Measurement Mode  . . . . . . . . . . . . . .  10
       4.2.3.  Loopback Measurement Mode . . . . . . . . . . . . . .  12
     4.3.  Additional Test Packet Processing Rules . . . . . . . . .  13
       4.3.1.  TTL and Hop Limit . . . . . . . . . . . . . . . . . .  13
       4.3.2.  Router Alert Option . . . . . . . . . . . . . . . . .  13
     4.4.  Delay Measurement for P2MP SR Policies  . . . . . . . . .  13
   5.  ECMP Support for SR Policies  . . . . . . . . . . . . . . . .  14
   6.  Performance Delay and Liveness Monitoring . . . . . . . . . .  15
   7.  Security Considerations . . . . . . . . . . . . . . . . . . .  15
   8.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  15
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  16
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .  16
     9.2.  Informative References  . . . . . . . . . . . . . . . . .  16
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  18
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  19






Gandhi, et al.            Expires July 29, 2021                 [Page 2]

Internet-Draft       Using STAMP for Segment Routing        January 2021


1.  Introduction

   Segment Routing (SR) leverages the source routing paradigm and
   greatly simplifies network operations for Software Defined Networks
   (SDNs).  SR is applicable to both Multiprotocol Label Switching (SR-
   MPLS) and IPv6 (SRv6) data planes.  SR takes advantage of the Equal-
   Cost Multipaths (ECMPs) between source and transit nodes, between
   transit nodes and between transit and destination nodes.  SR Policies
   as defined in [I-D.ietf-spring-segment-routing-policy] are used to
   steer traffic through a specific, user-defined paths using a stack of
   Segments.  Built-in SR Performance Measurement (PM) is one of the
   essential requirements to provide Service Level Agreements (SLAs).

   The Simple Two-way Active Measurement Protocol (STAMP) provides
   capabilities for the measurement of various performance metrics in IP
   networks using test packets [RFC8762].  It eliminates the need for
   control protocol by using configuration data model to provision test
   sessions.  [RFC8972] defines optional extensions for STAMP.

   This document describes procedures for Performance Measurement (PM)
   in SR networks using the mechanisms defined in [RFC8762] (STAMP) and
   its optional extensions [RFC8972].  The procedure described is
   applicable to SR-MPLS and SRv6 data planes and is used for both links
   and end-to-end SR paths including SR Policies and Flex-Algo IGP
   Paths.  Unless otherwise specified, the mechanisms defined in
   [RFC8762] and [RFC8972] are not modified by this document.

2.  Conventions Used in This Document

2.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119] [RFC8174]
   when, and only when, they appear in all capitals, as shown here.

2.2.  Abbreviations

   BSID: Binding Segment ID.

   DM: Delay Measurement.

   ECMP: Equal Cost Multi-Path.

   HMAC: Hashed Message Authentication Code.

   MPLS: Multiprotocol Label Switching.




Gandhi, et al.            Expires July 29, 2021                 [Page 3]

Internet-Draft       Using STAMP for Segment Routing        January 2021


   NTP: Network Time Protocol.

   OWAMP: One-Way Active Measurement Protocol.

   PM: Performance Measurement.

   PSID: Path Segment Identifier.

   PTP: Precision Time Protocol.

   SID: Segment ID.

   SL: Segment List.

   SR: Segment Routing.

   SRH: Segment Routing Header.

   SR-MPLS: Segment Routing with MPLS data plane.

   SRv6: Segment Routing with IPv6 data plane.

   SSID: STAMP Session Identifier.

   STAMP: Simple Two-way Active Measurement Protocol.

   TC: Traffic Class.

2.3.  Reference Topology

   In the reference topology shown below, the session-sender R1
   initiates a STAMP test packet and the session-reflector R3 sends a
   reply test packet.  The reply test packet is sent back to the
   session-sender R1 on the same path in the reverse direction or a
   different path.

   SR is enabled on nodes R1 and R3.  The nodes R1 and R3 may be
   directly connected via a link or there exists a Point-to-Point (P2P)
   SR path e.g.  SR Policy [I-D.ietf-spring-segment-routing-policy] on
   node R1 (called head-end) with destination to node R3 (called tail-
   end).










Gandhi, et al.            Expires July 29, 2021                 [Page 4]

Internet-Draft       Using STAMP for Segment Routing        January 2021


                          T1                T2
                         /                   \
                +-------+     Test Packet     +-------+
                |       | - - - - - - - - - ->|       |
                |   R1  |=====================|   R3  |
                |       |<- - - - - - - - - - |       |
                +-------+  Reply Test Packet  +-------+
                         \                   /
                          T4                T3

              Session-Sender              Session-Reflector

                          Reference Topology

3.  Overview

   For delay measurement in Segment Routing networks, the STAMP test
   packets defined in [RFC8762] are used.

   A UDP destination port number is selected using the procedure defined
   in [RFC8762].  The same destination UDP port is used for links and SR
   paths and the session-reflector is unaware if the received STAMP test
   packet is for the links or SR paths.

   For delay measurement, the STAMP test packets are sent on the same
   path (in-band) as the customer data traffic by the session-sender,
   and are used to measure the delay experienced by the customer data
   traffic flowing on the links and SR paths.

   The In-Situ Operations, Administration, and Maintenance (IOAM)
   mechanisms for SR-MPLS defined in [I-D.gandhi-mpls-ioam-sr] and for
   SRv6 defined in [I-D.ali-spring-ioam-srv6] are used to carry PM
   information such as timestamp in-band as part of the data packets,
   and are outside the scope of this document.

3.1.  Example Provisioning Model

   An example of a provisioning model and typical measurement parameters
   for a user-configured destination UDP port for delay measurement is
   shown in the following Figure 1:











Gandhi, et al.            Expires July 29, 2021                 [Page 5]

Internet-Draft       Using STAMP for Segment Routing        January 2021


                              +------------+
                              | Controller |
                              +------------+
                                  /    \
     Destination UDP Port        /      \    Destination UDP port
     Authentication Mode & Key  /        \   Authentication Mode & Key
     Delay Measurement Mode    /          \  Synthetic Loss Type`
         Timestamp Format     /            \
     Synthetic Loss Type     /              \
                            /                \
                           v                  v
                       +-------+            +-------+
                       |       |            |       |
                       |   R1  |============|   R3  |
                       |       |  SR path   |       |
                       +-------+  Or link   +-------+

                     Session-Sender      Session-Reflector

                   Figure 1: Example Provisioning Model

   Example of the Timestamp Format is PTPv2 [IEEE1588] or NTP.  Example
   of synthetic loss type can be stateful and stateless [RFC8762].

   The mechanisms to provision the session-sender and session-reflector
   are outside the scope of this document.  The provisioning model is
   not used for signaling the PM parameters between the session-sender
   and session-reflector in SR networks.

   The session-reflector R3 uses the parameters for the timestamp format
   and delay measurement mode (i.e. one-way or two-way mode) from the
   received STAMP test packet.

4.  Delay Measurement for Links and SR Paths

4.1.  Session-Sender Test Packet

   The STAMP test packets defined in [RFC8762] are used for delay
   measurement for links and end-to-end SR paths including SR Policies.
   The packet content for STAMP test packet using UDP header [RFC0768]
   is shown in Figure 2.  The payload contains the session-sender test
   packet defined in [RFC8762].









Gandhi, et al.            Expires July 29, 2021                 [Page 6]

Internet-Draft       Using STAMP for Segment Routing        January 2021


    +---------------------------------------------------------------+
    | IP Header                                                     |
    .  Source IP Address = Session-Sender IPv4 or IPv6 Address      .
    .  Destination IP Address=Session-Reflector IPv4 or IPv6 Address.
    .  Protocol = UDP                                               .
    .                                                               .
    +---------------------------------------------------------------+
    | UDP Header                                                    |
    .  Source Port = As chosen by Session-Sender                    .
    .  Destination Port = User-configured Port                      .
    .                                                               .
    +---------------------------------------------------------------+
    | Payload = Test Packet as specified in Section 4.2 of RFC 8762 |
    .                                                               .
    +---------------------------------------------------------------+

                   Figure 2: Session-Sender Test Packet

   Timestamp field is eight bytes and use the format defined in
   Section 4.2.1 of [RFC8762].  It is recommended to use the IEEE 1588v2
   Precision Time Protocol (PTP) truncated 64-bit timestamp format
   [IEEE1588] as specified in [RFC8186], with hardware support in
   Segment Routing networks.

   When using the authenticated mode for delay measurement, the matching
   authentication type (e.g.  HMAC-SHA-256) and key are user-configured
   on both the STAMP session-sender and session-reflector [RFC8762].

4.1.1.  Session-Sender Test Packet for links

   The STAMP test packet as shown in Figure 2 are sent over the link for
   delay measurement which may be physical, virtual or LAG (bundle), LAG
   (bundle) member, numbered/unnumbered link.  The local and remote IP
   addresses of the link are used as Source and Destination Addresses.
   They can also be IPv6 link local address.

4.1.2.  Session-Sender Test Packet for SR Policy

   The delay measurement for end-to-end SR path in segment routing is
   applicable to both end-to-end SR-MPLS and SRv6 Policies.

   The session-sender IPv4 or IPv6 address is used as the source
   address.  The endpoint IPv4 or IPv6 address is used as the
   destination address.  In the case of SR Policy with IPv4 endpoint of
   0.0.0.0 or IPv6 endpoint of ::0
   [I-D.ietf-spring-segment-routing-policy], the loopback address from
   the range 127/8 for IPv4, or the loopback address ::1/128 for IPv6 is
   used as the destination address, respectively.



Gandhi, et al.            Expires July 29, 2021                 [Page 7]

Internet-Draft       Using STAMP for Segment Routing        January 2021


4.1.2.1.  Session-Sender Test Packet for SR-MPLS Policy

   The test packets for delay measurement of an end-to-end SR-MPLS
   Policy is sent using its SR-MPLS header containing the MPLS segment
   list as shown in Figure 3.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Segment(1)             | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Segment(n)             | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                PSID                   | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Test Packet as shown in Figure 2               |
    .                                                               .
    +---------------------------------------------------------------+

      Figure 3: Example Session-Sender Test Packet for SR-MPLS Policy

   The Segment List (SL) can be empty to indicate Implicit NULL label
   case for a single-hop SR Policy.

   The Path Segment Identifier (PSID)
   [I-D.ietf-spring-mpls-path-segment] of the SR-MPLS Policy can be used
   as shown in Figure 3.

4.1.2.2.  Session-Sender Test Packet for SRv6 Policy

   An SRv6 Policy setup using the SRv6 Segment Routing Header (SRH) and
   a Segment List as defined in [RFC8754].  The SRv6 network programming
   is defined in [I-D.ietf-spring-srv6-network-programming].  The test
   packets for delay measurement of an end-to-end SRv6 Policy is sent
   using its SRH with Segment List as shown in Figure 4.  The procedure
   defined for upper-layer header processing for SRv6 SIDs in
   [I-D.ietf-spring-srv6-network-programming] is used to process the UDP
   header in the received test packets.









Gandhi, et al.            Expires July 29, 2021                 [Page 8]

Internet-Draft       Using STAMP for Segment Routing        January 2021


    +---------------------------------------------------------------+
    | IP Header                                                     |
    .  Source IP Address = Session-Sender IPv6 Address              .
    .  Destination IP Address = Destination IPv6 Address            .
    .                                                               .
    +---------------------------------------------------------------+
    | SRH as specified in RFC 8754                                  |
    .  <Segment List>                                               .
    .                                                               .
    +---------------------------------------------------------------+
    | IP Header                                                     |
    .  Source IP Address = Session-Sender IPv6 Address              .
    .  Destination IP Address = Session-Reflector IPv6 Address      .
    .                                                               .
    +---------------------------------------------------------------+
    | UDP Header                                                    |
    .  Source Port = As chosen by Session-Sender                    .
    .  Destination Port = User-configured Port                      .
    .                                                               .
    +---------------------------------------------------------------+
    |  Test Packet as shown in Figure 2                             |
    .                                                               .
    +---------------------------------------------------------------+

       Figure 4: Example Session-Sender Test Packet for SRv6 Policy

4.2.  Session-Reflector Test Packet

   The reply test packet is sent using the IP/UDP information from the
   received test packet.  The content of the reply test packet is shown
   in Figure 5.




















Gandhi, et al.            Expires July 29, 2021                 [Page 9]

Internet-Draft       Using STAMP for Segment Routing        January 2021


    +---------------------------------------------------------------+
    | IP Header                                                     |
    .  Source IP Address = Session-Reflector IPv4 or IPv6 Address   .
    .  Destination IP Address = Source IP Address from Test Packet  .
    .  Protocol = UDP                                               .
    .                                                               .
    +---------------------------------------------------------------+
    | UDP Header                                                    |
    .  Source Port = As chosen by Session-Reflector                 .
    .  Destination Port = Source Port from Test Packet              .
    .                                                               .
    +---------------------------------------------------------------+
    | Payload = Test Packet as specified in Section 4.3 of RFC 8762 |
    .                                                               .
    +---------------------------------------------------------------+

                  Figure 5: Session-Reflector Test Packet

4.2.1.  One-way Measurement Mode

   In one-way delay measurement mode, the reply test packet as defined
   in Figure 5 is sent back out-of-band to the session-sender, for both
   links and SR Policies.  The Session-Sender Control Code is set to the
   default value of 0 [I-D.gandhi-ippm-stamp-srpm].  In this delay
   measurement mode, as per Reference Topology, all timestamps T1, T2,
   T3, and T4 are collected by the test packets.  However, only
   timestamps T1 and T2 are used to measure one-way delay as (T2 - T1).

   For one-way delay measurement, the session-sender address may not be
   reachable via IP route from the session-reflector.  The session-
   sender in this case needs to send its reachability path information
   to the session-reflector using Return Path TLV defined in
   [I-D.gandhi-ippm-stamp-srpm].

4.2.2.  Two-way Measurement Mode

   In two-way delay measurement mode, when using a bidirectional path,
   the reply test packet as defined in Figure 5 is sent back to the
   session-sender on the same path (in-band) as the data traffic on the
   same reverse direction link or associated reverse SR Policy
   [I-D.ietf-pce-sr-bidir-path].  The Session-Sender Control Code is set
   to "In-band Response Requested" [I-D.gandhi-ippm-stamp-srpm].  In
   this delay measurement mode, as per Reference Topology, all
   timestamps T1, T2, T3, and T4 are collected by the test packets.  All
   four timestamps are used to measure two-way delay as ((T4 - T1) - (T3
   - T2)).





Gandhi, et al.            Expires July 29, 2021                [Page 10]

Internet-Draft       Using STAMP for Segment Routing        January 2021


   For two-way measurement mode for links, the reply test packet is sent
   back on the incoming physical interface where the test packet is
   received.

   For two-way measurement mode for SR Policy, the session-reflector
   needs to send the reply test packet on a specific reverse path.  The
   session-sender node can request in the test packet to the session-
   reflector to send a reply test packet back on a given reverse path
   (e.g.  bidirectional path) using Return Path TLV defined in
   [I-D.gandhi-ippm-stamp-srpm].

4.2.2.1.  Session-Reflector Test Packet for SR-MPLS Policy

   The packet content for sending reply test packet for two-way delay
   measurement of an end-to-end SR-MPLS Policy is shown in Figure 6.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Segment(1)             | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Segment(n)             | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                Test Packet as shown in Figure 5               |
    .                                                               .
    +---------------------------------------------------------------+

    Figure 6: Example Session-Reflector Test Packet for SR-MPLS Policy

   The Path Segment Identifier (PSID)
   [I-D.ietf-spring-mpls-path-segment] of the forward SR Policy in the
   test packet can be used to find the associated reverse SR Policy
   [I-D.ietf-pce-sr-bidir-path] to send the test reply test packet for
   two-way measurement of SR Policy unless when using STAMP packet with
   Return Path TLV.

4.2.2.2.  Session-Reflector Test Packet for SRv6 Policy

   The packet content for sending reply test packet on the same path
   (in-band) as the data traffic for two-way performance measurement of
   an end-to-end SRv6 Policy with SRH is shown in Figure 7.  The
   procedure defined for upper-layer header processing for SRv6 SIDs in
   [I-D.ietf-spring-srv6-network-programming] is used to process the UDP
   header in the received reply test packets.



Gandhi, et al.            Expires July 29, 2021                [Page 11]

Internet-Draft       Using STAMP for Segment Routing        January 2021


    +---------------------------------------------------------------+
    | IP Header                                                     |
    .  Source IP Address = Session-Reflector IPv6 Address           .
    .  Destination IP Address = Destination IPv6 Address            .
    .                                                               .
    +---------------------------------------------------------------+
    | SRH as specified in RFC 8754                                  |
    .  <Segment List>                                               .
    .                                                               .
    +---------------------------------------------------------------+
    | IP Header (as needed)                                         |
    .  Source IP Address = Session-Reflector IPv6 Address           .
    .  Destination IP Address = Source IPv6 Address from Test Packet.
    .                                                               .
    +---------------------------------------------------------------+
    | UDP Header                                                    |
    .  Source Port = As chosen by Session-Sender                    .
    .  Destination Port = User-configured Port                      .
    .                                                               .
    +---------------------------------------------------------------+
    |  Test Packet as shown in Figure 5                             |
    .                                                               .
    +---------------------------------------------------------------+

      Figure 7: Example Session-Reflector Test Packet for SRv6 Policy

4.2.3.  Loopback Measurement Mode

   The loopback measurement mode can be used to measure round-trip delay
   of a bidirectional SR path.  The IP header of the session-sender test
   packet contains the destination address equals to the session-sender
   address and the source address equals to the session-reflector
   address.  Optionally, the test packet can carry the reverse path
   information (e.g.  reverse path label stack for SR-MPLS) as part of
   the SR header.  The received test packets are not punted at the
   session-reflector and it does not process them and generate reply
   test packets.  The Session-Sender Control Code is set to the default
   value of 0 [I-D.gandhi-ippm-stamp-srpm].  In this mode, as the test
   packet is not punted on the session-reflector for processing, the
   session-sender copies the 'Sequence Number' in 'Session-Sender
   Sequence Number' directly before sending the test packet.  In this
   delay measurement mode, as per Reference Topology, the timestamps T1
   and T4 are collected by the test packets.  Both these timestamps are
   used to measure round-trip delay as (T4 - T1).







Gandhi, et al.            Expires July 29, 2021                [Page 12]

Internet-Draft       Using STAMP for Segment Routing        January 2021


4.3.  Additional Test Packet Processing Rules

   The processing rules defined in this section are applicable to the
   STAMP packets for delay for links and end-to-end SR paths including
   SR Policies.

4.3.1.  TTL and Hop Limit

   The TTL field in the IPv4 and MPLS headers of the test packets is set
   to 255 [RFC8762].  Similarly, the Hop Limit field in the IPv6 and SRH
   headers of the test packets is set to 255 [RFC8762].

   When using the Destination IPv4 Address from range 127/8, the TTL
   field in the IPv4 header is set to 1 [RFC8029].  Similarly, when
   using the Destination IPv6 Address from the ::FFFF:127/104 range, the
   Hop Limit field in the IPv6 header is set to 1.

   For link delay, the TTL or Hop Limit field in the test packet is set
   to 1 in both one-way and two-way measurement modes.

4.3.2.  Router Alert Option

   The Router Alert IP option (RAO) [RFC2113] is not set in the test
   packets.

4.4.  Delay Measurement for P2MP SR Policies

   The Point-to-Multipoint (P2MP) SR path that originates from a root
   node terminates on multiple destinations called leaf nodes (e.g.
   P2MP SR Policy [I-D.ietf-pim-sr-p2mp-policy] or P2MP Transport
   [I-D.shen-spring-p2mp-transport-chain]).

   The procedures for delay measurement described in this document for
   P2P SR Policies are also equally applicable to the P2MP SR Policies.
   The procedure for one-way measurement mode is defined as following:

   o  The session-sender root node sends test packets using the Tree-SID
      defined in [I-D.ietf-pim-sr-p2mp-policy] for the P2MP SR-MPLS
      Policy as shown in Figure 8.

   o  The test packets can contain the replication SID as defined in
      [I-D.ietf-spring-sr-replication-segment].

   o  The Destination Address is set to the loopback address from range
      127/8 for IPv4, or the loopback address ::1/128 for IPv6 address.

   o  Each session-reflector leaf node sends its IP address in the
      Source Address of the reply test packets as shown in Figure 8.



Gandhi, et al.            Expires July 29, 2021                [Page 13]

Internet-Draft       Using STAMP for Segment Routing        January 2021


      This allows the session-sender root node to identify the session-
      reflector leaf nodes of the P2MP SR Policy.

   o  The P2MP root node measures the delay for each P2MP leaf node of
      the end-to-end P2MP SR Policy.


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Tree-SID                 | TC  |S|      TTL      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Test Packet as shown in Figure 2                            |
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Figure 8: Example Test Packet with Tree-SID for SR-MPLS Policy

   The test packets can also be sent using the scheme defined for P2MP
   Transport using Chain Replication that may contain Bud SID as defined
   in [I-D.shen-spring-p2mp-transport-chain].

   The considerations for two-way mode for P2MP SR Policy (e.g. for
   bidirectional SR path) are outside the scope of this document.

5.  ECMP Support for SR Policies

   An SR Policy can have ECMPs between the source and transit nodes,
   between transit nodes and between transit and destination nodes.
   Usage of Anycast SID [RFC8402] by an SR Policy can result in ECMP
   paths via transit nodes part of that Anycast group.  The test packets
   need to be sent to traverse different ECMP paths to measure delay of
   an SR Policy.

   Forwarding plane has various hashing functions available to forward
   packets on specific ECMP paths.  The mechanisms described in
   [RFC8029] and [RFC5884] for handling ECMPs are also applicable to the
   delay measurement.  In IPv4 header of the test packets, sweeping of
   Destination Address from range 127/8 can be used to exercise
   particular ECMP paths.  As specified in [RFC6437], Flow Label field
   in the outer IPv6 header can also be used for sweeping.

   The Destination Node Address TLV [I-D.gandhi-ippm-stamp-srpm] can be
   sent in the session-sender test packet to identify the intended



Gandhi, et al.            Expires July 29, 2021                [Page 14]

Internet-Draft       Using STAMP for Segment Routing        January 2021


   destination node.  The session-reflector MUST NOT send reply test
   packet if it is not the intended destination node in the Destination
   Node Address TLV [I-D.gandhi-ippm-stamp-srpm].

6.  Performance Delay and Liveness Monitoring

   Liveness monitoring is required for connectivity verification and
   continuity check in an SR network.  The procedure defined in this
   document for delay measurement using the STAMP test packets can also
   be applied to liveness monitoring of links and SR paths.  The one-way
   or two-way measurement mode can be used for liveness monitoring.
   Liveness failure is notified when consecutive N number of reply test
   packets are not received back at the session-sender, where N is
   locally provisioned value.  Note that for one-way and two-way modes,
   the failure detection interval and scale for number of test packets
   need to account for the processing of the test packets which need to
   be punted from the forwarding fast path (to slow path or control
   plane) and reply test packets need to be injected on the session-
   reflector.  This is improved by using the test packets in loopback
   mode.

7.  Security Considerations

   The performance measurement is intended for deployment in well-
   managed private and service provider networks.  As such, it assumes
   that a node involved in a measurement operation has previously
   verified the integrity of the path and the identity of the far-end
   session-reflector.

   If desired, attacks can be mitigated by performing basic validation
   and sanity checks, at the session-sender, of the counter or timestamp
   fields in received measurement reply test packets.  The minimal state
   associated with these protocols also limits the extent of measurement
   disruption that can be caused by a corrupt or invalid packet to a
   single test cycle.

   Use of HMAC-SHA-256 in the authenticated mode protects the data
   integrity of the test packets.  SRv6 has HMAC protection
   authentication defined for SRH [RFC8754].  Hence, test packets for
   SRv6 may not need authentication mode.  Cryptographic measures may be
   enhanced by the correct configuration of access-control lists and
   firewalls.

8.  IANA Considerations

   This document does not require any IANA action.





Gandhi, et al.            Expires July 29, 2021                [Page 15]

Internet-Draft       Using STAMP for Segment Routing        January 2021


9.  References

9.1.  Normative References

   [RFC0768]  Postel, J., "User Datagram Protocol", STD 6, RFC 768,
              DOI 10.17487/RFC0768, August 1980,
              <https://www.rfc-editor.org/info/rfc768>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8762]  Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple
              Two-Way Active Measurement Protocol", RFC 8762,
              DOI 10.17487/RFC8762, March 2020,
              <https://www.rfc-editor.org/info/rfc8762>.

   [RFC8972]  Mirsky, G., Min, X., Nydell, H., Foote, R., Masputra, A.,
              and E. Ruffini, "Simple Two-Way Active Measurement
              Protocol Optional Extensions", RFC 8972,
              DOI 10.17487/RFC8972, January 2021,
              <https://www.rfc-editor.org/info/rfc8972>.

   [I-D.gandhi-ippm-stamp-srpm]
              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.
              Janssens, "Simple TWAMP (STAMP) Extensions for Segment
              Routing Networks", draft-gandhi-ippm-stamp-srpm-01 (work
              in progress), January 2021.

9.2.  Informative References

   [IEEE1588]
              IEEE, "1588-2008 IEEE Standard for a Precision Clock
              Synchronization Protocol for Networked Measurement and
              Control Systems", March 2008.

   [RFC2113]  Katz, D., "IP Router Alert Option", RFC 2113,
              DOI 10.17487/RFC2113, February 1997,
              <https://www.rfc-editor.org/info/rfc2113>.







Gandhi, et al.            Expires July 29, 2021                [Page 16]

Internet-Draft       Using STAMP for Segment Routing        January 2021


   [RFC5884]  Aggarwal, R., Kompella, K., Nadeau, T., and G. Swallow,
              "Bidirectional Forwarding Detection (BFD) for MPLS Label
              Switched Paths (LSPs)", RFC 5884, DOI 10.17487/RFC5884,
              June 2010, <https://www.rfc-editor.org/info/rfc5884>.

   [RFC6437]  Amante, S., Carpenter, B., Jiang, S., and J. Rajahalme,
              "IPv6 Flow Label Specification", RFC 6437,
              DOI 10.17487/RFC6437, November 2011,
              <https://www.rfc-editor.org/info/rfc6437>.

   [RFC8029]  Kompella, K., Swallow, G., Pignataro, C., Ed., Kumar, N.,
              Aldrin, S., and M. Chen, "Detecting Multiprotocol Label
              Switched (MPLS) Data-Plane Failures", RFC 8029,
              DOI 10.17487/RFC8029, March 2017,
              <https://www.rfc-editor.org/info/rfc8029>.

   [RFC8186]  Mirsky, G. and I. Meilik, "Support of the IEEE 1588
              Timestamp Format in a Two-Way Active Measurement Protocol
              (TWAMP)", RFC 8186, DOI 10.17487/RFC8186, June 2017,
              <https://www.rfc-editor.org/info/rfc8186>.

   [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,
              Decraene, B., Litkowski, S., and R. Shakir, "Segment
              Routing Architecture", RFC 8402, DOI 10.17487/RFC8402,
              July 2018, <https://www.rfc-editor.org/info/rfc8402>.

   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,
              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header
              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,
              <https://www.rfc-editor.org/info/rfc8754>.

   [I-D.ietf-spring-segment-routing-policy]
              Filsfils, C., Talaulikar, K., Voyer, D., Bogdanov, A., and
              P. Mattes, "Segment Routing Policy Architecture", draft-
              ietf-spring-segment-routing-policy-09 (work in progress),
              November 2020.

   [I-D.ietf-spring-sr-replication-segment]
              Voyer, D., Filsfils, C., Parekh, R., Bidgoli, H., and Z.
              Zhang, "SR Replication Segment for Multi-point Service
              Delivery", draft-ietf-spring-sr-replication-segment-03
              (work in progress), October 2020.

   [I-D.shen-spring-p2mp-transport-chain]
              Shen, Y., Zhang, Z., Parekh, R., Bidgoli, H., and Y.
              Kamite, "Point-to-Multipoint Transport Using Chain
              Replication in Segment Routing", draft-shen-spring-p2mp-
              transport-chain-03 (work in progress), October 2020.



Gandhi, et al.            Expires July 29, 2021                [Page 17]

Internet-Draft       Using STAMP for Segment Routing        January 2021


   [I-D.ietf-pim-sr-p2mp-policy]
              Voyer, D., Filsfils, C., Parekh, R., Bidgoli, H., and Z.
              Zhang, "Segment Routing Point-to-Multipoint Policy",
              draft-ietf-pim-sr-p2mp-policy-01 (work in progress),
              October 2020.

   [I-D.ietf-spring-mpls-path-segment]
              Cheng, W., Li, H., Chen, M., Gandhi, R., and R. Zigler,
              "Path Segment in MPLS Based Segment Routing Network",
              draft-ietf-spring-mpls-path-segment-03 (work in progress),
              September 2020.

   [I-D.ietf-spring-srv6-network-programming]
              Filsfils, C., Camarillo, P., Leddy, J., Voyer, D.,
              Matsushima, S., and Z. Li, "SRv6 Network Programming",
              draft-ietf-spring-srv6-network-programming-28 (work in
              progress), December 2020.

   [I-D.gandhi-mpls-ioam-sr]
              Gandhi, R., Ali, Z., Filsfils, C., Brockners, F., Wen, B.,
              and V. Kozak, "MPLS Data Plane Encapsulation for In-situ
              OAM Data", draft-gandhi-mpls-ioam-sr-05 (work in
              progress), January 2021.

   [I-D.ali-spring-ioam-srv6]
              Ali, Z., Gandhi, R., Filsfils, C., Brockners, F., Nainar,
              N., Pignataro, C., Li, C., Chen, M., and G. Dawra,
              "Segment Routing Header encapsulation for In-situ OAM
              Data", draft-ali-spring-ioam-srv6-03 (work in progress),
              November 2020.

   [I-D.ietf-pce-sr-bidir-path]
              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,
              "Path Computation Element Communication Protocol (PCEP)
              Extensions for Associated Bidirectional Segment Routing
              (SR) Paths", draft-ietf-pce-sr-bidir-path-04 (work in
              progress), January 2021.

Acknowledgments

   The authors would like to thank Thierry Couture for the discussions
   on the use-cases for Performance Measurement in Segment Routing.  The
   authors would also like to thank Greg Mirsky for reviewing this
   document and providing useful comments and suggestions.  Patrick
   Khordoc and Radu Valceanu, both from Cisco Systems have helped
   significantly improve the mechanisms defined in this document.  The
   authors would also like to thank Sam Aldrin for the discussions to
   check for broken path.



Gandhi, et al.            Expires July 29, 2021                [Page 18]

Internet-Draft       Using STAMP for Segment Routing        January 2021


Authors' Addresses

   Rakesh Gandhi (editor)
   Cisco Systems, Inc.
   Canada

   Email: rgandhi@cisco.com


   Clarence Filsfils
   Cisco Systems, Inc.

   Email: cfilsfil@cisco.com


   Daniel Voyer
   Bell Canada

   Email: daniel.voyer@bell.ca


   Mach(Guoyi) Chen
   Huawei

   Email: mach.chen@huawei.com


   Bart Janssens
   Colt

   Email: Bart.Janssens@colt.net




















Gandhi, et al.            Expires July 29, 2021                [Page 19]
