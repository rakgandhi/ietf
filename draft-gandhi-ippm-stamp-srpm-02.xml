<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC0768 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.0768.xml">
<!ENTITY RFC2119 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC8174 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8762 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8762.xml">
<!ENTITY I-D.ietf-ippm-stamp-option-tlv SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-ippm-stamp-option-tlv.xml">
<!ENTITY RFC2104 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2104.xml">
<!ENTITY RFC2113 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2113.xml">
<!ENTITY RFC4868 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4868.xml">
<!ENTITY RFC5884 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5884.xml">
<!ENTITY RFC6335 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6335.xml">
<!ENTITY RFC6437 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6437.xml">
<!ENTITY RFC6936 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6936.xml">
<!ENTITY RFC7820 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7820.xml">
<!ENTITY RFC8029 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8029.xml">
<!ENTITY RFC8085 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8085.xml">
<!ENTITY RFC8126 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml">
<!ENTITY RFC8186 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8186.xml">
<!ENTITY RFC8402 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml">
<!ENTITY RFC8754 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8754.xml">
<!ENTITY I-D.ietf-pce-binding-label-sid SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-pce-binding-label-sid.xml">
<!ENTITY I-D.ietf-pce-sr-bidir-path SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-pce-sr-bidir-path.xml">
]>
<rfc submissionType="IETF" docName="draft-gandhi-ippm-stamp-srpm-02" category="std" ipr="trust200902">
	<!-- Generated by id2xml 1.5.0 on 2020-02-06T01:41:26Z -->
	<?rfc compact="yes"?>
	<?rfc text-list-symbols="oo*+-"?>
	<?rfc subcompact="no"?>
	<?rfc sortrefs="no"?>
	<?rfc symrefs="yes"?>
	<?rfc strict="yes"?>
	<?rfc toc="yes"?>
	<front>
	<title abbrev="STAMP Extensions for Segment Routing">Simple TWAMP (STAMP) Extensions for Segment Routing Networks</title>
	<author fullname="Rakesh Gandhi" initials="R." role="editor" surname="Gandhi">
	<organization>Cisco Systems, Inc.</organization>
	<address><postal><street>Canada</street>
	</postal>
        <email>rgandhi@cisco.com</email>
	</address>
	</author>

	<author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
	<organization>Cisco Systems, Inc.</organization>
        <address>
        <email>cfilsfil@cisco.com</email>
	</address>
	</author>

	<author fullname="Daniel Voyer" initials="D." surname="Voyer">
	<organization>Bell Canada</organization>
        <address>
        <email>daniel.voyer@bell.ca</email>
	</address>
	</author>

	<author fullname="Mach(Guoyi) Chen" initials="M." surname="Chen">
	<organization>Huawei</organization>
        <address>
        <email>mach.chen@huawei.com</email>
	</address>
	</author>

	<author fullname="Bart Janssens" initials="B." surname="Janssens">
	<organization>Colt</organization>
        <address>
	<email>Bart.Janssens@colt.net</email>
	</address>
	</author>

	<date day="21" month="January" year="2021"/>
	<workgroup>IPPM Working Group</workgroup>
	<abstract><t>
   Segment Routing (SR) leverages the source routing paradigm.  SR is
   applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6
   (SRv6) data planes.  This document specifies RFC 8762 
   (Simple Two-Way Active Measurement Protocol (STAMP))
   extensions for Segment Routing networks, for both
   SR-MPLS and SRv6 data planes.</t>

	</abstract>
	</front>

	<middle>
	<section title="Introduction" anchor="sect-1"><t>
   Segment Routing (SR) leverages the source routing paradigm and
   greatly simplifies network operations for Software Defined Networks
   (SDNs).  SR is applicable to both Multiprotocol Label Switching
   (SR-MPLS) and IPv6 (SRv6) data planes.  
   Built-in SR Performance Measurement (PM) is one of the
   essential requirements to provide Service Level Agreements (SLAs).</t>

   <t>The Simple Two-way Active Measurement Protocol (STAMP) provides
   capabilities for the measurement of various performance
   metrics in IP networks using test packets <xref target="RFC8762"/>. 
   It eliminates the need for control-channel signaling by using
   configuration data model to provision a test-channel (e.g. UDP paths). 
   <xref target="I-D.ietf-ippm-stamp-option-tlv"/>
   defines TLV extensions for STAMP packets.</t>

   <t>This document specifies RFC 8762 
   (Simple Two-Way Active Measurement Protocol (STAMP))
   extensions for Segment Routing networks, for both
   SR-MPLS and SRv6 data planes.</t>
	</section>

	<section title="Conventions Used in This Document" anchor="sect-2">
	<section title="Requirements Language" anchor="sect-2.1"><t>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <xref target="RFC2119"/> <xref target="RFC8174"/>
   when, and only when, they appear in all capitals, as shown here.</t>

	</section>

	<section title="Abbreviations" anchor="sect-2.2"><t>
   BSID: Binding Segment ID.</t>

	<t>
   DM: Delay Measurement.</t>

	<t>
   HMAC: Hashed Packet Authentication Code.</t>

	<t>
   MPLS: Multiprotocol Label Switching.</t>

	<t>
   NTP: Network Time Protocol.</t>

	<t>
   OWAMP: One-Way Active Measurement Protocol.</t>

	<t>
   PM: Performance Measurement.</t>

	<t>
   PTP: Precision Time Protocol.</t>

	<t>
   SID: Segment ID.</t>

	<t>
   SL: Segment List.</t>

	<t>
   SR: Segment Routing.</t>

	<t>
   SRH: Segment Routing Header.</t>

	<t>
   SR-MPLS: Segment Routing with MPLS data plane.</t>

	<t>
   SRv6: Segment Routing with IPv6 data plane.</t>

	<t>
   SSID: STAMP Session Identifier.</t>

	<t>
   STAMP: Simple Two-way Active Measurement Protocol.</t>

	</section>

	<section title="Reference Topology" anchor="sect-2.3"><t>
   In the reference topology shown below, the session-sender node R1 initiates a
   STAMP test packet and the session-reflector node R3
   sends reply for the test packet received to the session-sender node R1.</t>  

	<figure><artwork><![CDATA[
                       T1                T2
                      /                   \
             +-------+     Test Packet     +-------+
             |       | - - - - - - - - - ->|       |
             |   R1  |=====================|   R3  |
             |       |<- - - - - - - - - - |       |
             +-------+     Reply           +-------+
                      \                   /
                       T4                T3

             Session-Sender                Session-Reflector

                      Reference Topology
]]></artwork>
	</figure>
	</section>
	</section>

	<section title="Session-Sender Control Code Field Extension" anchor="sect-3">
	<t>In this document, the Session-Sender Control Code field is defined for test packets
   for STAMP protocol <xref target="RFC8762"/> in unauthenticated and authenticated modes.  
   The modified STAMP test packet format is shown in Figure 1. 
   This packet format is backwards
   compatible with the packet format defined in STAMP <xref target="RFC8762"/> as its session-reflector MUST
   ignore the received field (previously identified as MBZ).
   With this field, the session-reflector node does not require
   any additional state information for the STAMP session (recall that in SR networks, 
   the state is in the packet and signaling of the parameters is undesired). 
   The usage of the Control Code is not limited to the SR and can be used for non-SR network.</t>

   <figure title="Session-Sender Control Code in STAMP Test Packet" anchor="ure-se-control-code-in-stamp-packet"><artwork><![CDATA[
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Sequence Number                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Timestamp                              |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |         Error Estimate        | SSID                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |         MBZ                                   |Se Control Code|
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 |                        MBZ  (24 octets)                       |
 |                                                               |
 |                                                               |
 |                                                               |
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>

   <t>
   Session-Sender Control Code: Set as follows in STAMP test packet.</t>
   <t>  </t>

	<t><list hangIndent="4" style="hanging"><t>
       0x0: Out-of-band Reply Requested.  Indicates that the test packet reply
       is not required over the same path in the reverse direction.
       This is also the default behavior.</t>
	</list>
	</t>

	<t><list hangIndent="4" style="hanging"><t>
       0x1: In-band Reply Requested.  Indicates that this query has
       been sent over a bidirectional path and the test packet reply is required
       over the same path in the reverse direction.</t> 
	</list>
	</t>

	<t><list hangIndent="4" style="hanging"><t>
       0x2: No Reply Requested.</t>
	</list>
	</t>

	</section>

	<section title="Destination Node Address TLV Extensions" anchor="sect-5">
        <t>In this document, Destination Node Address TLV is defined for STAMP packet <xref target="I-D.ietf-ippm-stamp-option-tlv"/> 
        and has the following format shown in Figure 2:</t>


	<figure title="Destination Node Address TLV Format" anchor="ure-node-address-tlv-format"><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type      |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Reserved                      | Address Family                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 ~                           Address                             ~
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>

   <t>The Address Family field indicates the type of the address, and it
   SHALL be set to one of the assigned values in the "IANA Address Family Numbers" registry.</t>

   <t>The STAMP TLV Flags are set using the procedures described in <xref target="I-D.ietf-ippm-stamp-option-tlv"/>.</t>

   <t>The following Type is defined for Destination Node Address TLV:</t>

   <t>Destination Node Address (value TBA1):</t>
   <t>
   The Destination Node Address TLV is optional.  The Destination Node
   Address TLV indicates the address of the intended recipient node of the
   test packet.  The session-reflector node MUST NOT send reply packet if it
   is not the intended destination node of the test packet.</t>
	</section>

	<section title="Return Path TLV Extensions" anchor="sect-6"><t>
   For two-way performance measurement, the session-reflector node needs to send
   the test packet reply packet on a specific reverse path.  The session-sender
   node can request in the test packet to the session-reflector node to
   send a reply packet back on a given reverse path (e.g. co-routed
   bidirectional path).  This way the session-reflector node does not require
   any additional state for the STAMP session (recall that in SR networks, 
   the state is in the packet and signaling of the parameters is undesired).</t>

	<t>
   For one-way performance measurement, the session-sender node address may not
   be reachable via IP route from the session-reflector node.  The session-sender node
   in this case needs to send its reachability path information to the
   session-reflector node.</t>

	<t>
   <xref target="I-D.ietf-ippm-stamp-option-tlv"/> defines STAMP test packets that
   can include one or more optional TLVs.  The TLV Type (value TBA2) is
   defined in this document for Return Path that carries reverse path for STAMP
   test packet reply packets (in the payload of the packet).  The format
   of the Return Path TLV is shown in Figure 3:</t>

	<figure title="Return Path TLV" anchor="ure-return-path-tlv"><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|   Type=TBA2   |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Return Path Sub-TLV                        |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>

   <t>The following Type defined for the Return Path TLV contains the Return Address sub-TLV using the format shown in Figure 4:</t>

	<t><list style="symbols"><t>Type (value 1): Return Address. Target node address of the
      reply packet different than the Source Address in the received test packet.</t>

	</list>
	</t>

	<figure title="Return Address Sub-TLV in Return Path TLV" anchor="ure-return-node-address-tlv-format"><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type      |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 | Reserved                      | Address Family                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 ~                           Address                             ~
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>

	<t>
   The Segment List Sub-TLV (format as shown in Figure 5) in the Return Path TLV can be one of the following Types:</t>

	<t><list style="symbols"><t>Type (value 2): SR-MPLS Label Stack of the Reverse Path</t>

	<t>Type (value 3): SR-MPLS Binding SID <xref target="I-D.ietf-pce-binding-label-sid"/> of
      the Reverse SR Policy</t>

	<t>Type (value 4): SRv6 Segment List of the Reverse Path</t>

	<t>Type (value 5): SRv6 Binding SID <xref target="I-D.ietf-pce-binding-label-sid"/> of
      the Reverse SR Policy</t>

	</list>
	</t>


	<figure title="Segment List Sub-TLV in Return Path TLV" anchor="ure-segment-list-sub-tlv-in-return-path-tlv"><artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |STAMP TLV Flags|     Type      |         Length                |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Segment(1)                                 |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 .                                                               .
 .                                                               .
 .                                                               .

 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Segment(n)                                 |
 .                                                               .
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
	</figure>

   <t>The STAMP TLV Flags are set using the procedures described in <xref target="I-D.ietf-ippm-stamp-option-tlv"/>.</t>

	<t>
   The Return Path TLV is optional. The session-sender node MUST only insert
   one Return Path TLV in the test packet and the session-reflector node
   MUST only process the first Return Path TLV in the test
   packet and ignore other Return Path TLVs if present. Similarly, the session-sender
   node MUST only insert one Return Path Sub-TLV in the test packet and the session-reflector
   node MUST only process the first Return Path Sub-TLV in the test packet and ignore other Return
   Path Sub-TLVs if present. The session-reflector
   node MUST send test packet reply packet back on the reverse path
   specified in the Return Path TLV and MUST NOT add Return Path TLV in
   the test packet reply.</t>

	</section>

	<section title="Security Considerations" anchor="sect-7"><t>
   The performance measurement is intended for deployment in
   well-managed private and service provider networks.  As such, it
   assumes that a node involved in a measurement operation has
   previously verified the integrity of the path and the identity of the
   far-end session-reflector node.</t>

	<t>
   If desired, attacks can be mitigated by performing basic validation
   and sanity checks, at the session-sender, of the counter or timestamp fields
   in received measurement reply packets.  The minimal state
   associated with these protocols also limits the extent of measurement
   disruption that can be caused by a corrupt or invalid packet to a
   single query/reply cycle.</t>

	<t>
   Use of HMAC-SHA-256 in the authenticated mode protects the data
   integrity of the test packets. Cryptographic measures may be enhanced by the correct configuration
   of access-control lists and firewalls.</t>

	</section>

	<section title="IANA Considerations" anchor="sect-8"><t>
   IANA will create a "STAMP TLV Type" registry for <xref target="I-D.ietf-ippm-stamp-option-tlv"/>. 
   IANA is requested to allocate a value for the following 
   Destination Address TLV Type from the IETF Review TLV range of this registry. 
   This TLV is to be carried in the test packets.</t>

	<t><list style="symbols"><t>Type TBA1: Destination Node Address TLV</t>

	</list>
	</t>

   <t>
   IANA is also requested to allocate a value for the following 
   Return Path TLV Type from the IETF Review TLV range of the same registry. 
   This TLV is to be carried in the test packets.</t>

	<t><list style="symbols"><t>Type TBA2: Return Path TLV</t>

	</list>
	</t>

   <t>
   IANA is requested to create a sub-registry for "Return Path Sub-TLV Type".
   All code points in the range 1 through 175 in this registry shall be
   allocated according to the "IETF Review" procedure as specified in
   <xref target="RFC8126"/>.  Code points in the range 176 through 239 in this
   registry shall be allocated according to the "First Come First
   Served" procedure as specified in <xref target="RFC8126"/>. 
   Remaining code points are allocated according to <xref target="iana-return-path-tbl"/>:
   </t>

     <texttable anchor="iana-return-path-tbl" title="Return Path Sub-TLV Type Registry">
    <ttcol align="left">Value</ttcol>
    <ttcol align="center">Description</ttcol>
    <ttcol align="left">Reference</ttcol>
     <c>0</c>
    <c>Reserved</c>
    <c>This document</c>
     <c>1 - 175</c>
    <c>Unassigned</c>
    <c>This document</c>
     <c>176 - 239</c>
    <c>Unassigned</c>
    <c>This document</c>
     <c>240 - 251</c>
    <c>Experimental</c>
    <c>This document</c>
     <c>252 - 254</c>
    <c>Private Use</c>
    <c>This document</c>
    <c>255</c>
    <c>Reserved</c>
    <c>This document</c>
   </texttable> 

 
   <t>
   IANA is requested to allocate the values for the following Sub-TLV Types from this registry.</t>

	<t><list style="symbols"><t>Type (value 1): Return Address</t>

	<t>Type (value 2): SR-MPLS Label Stack of the Reverse Path</t>

	<t>Type (value 3): SR-MPLS Binding SID <xref target="I-D.ietf-pce-binding-label-sid"/>
                         of the Reverse SR Policy</t>

	<t>Type (value 4): SRv6 Segment List of the Reverse Path</t>

	<t>Type (value 5): SRv6 Binding SID <xref target="I-D.ietf-pce-binding-label-sid"/> of
                         the Reverse SR Policy</t>

	</list>
	</t>


	</section>

	</middle>

	<back>
	<references title="Normative References">
	&RFC2119;
	&RFC8174;
	&RFC8762;
	&I-D.ietf-ippm-stamp-option-tlv;
	</references>
	<references title="Informative References">
	&RFC8126;
	&I-D.ietf-pce-binding-label-sid;
	</references>
	<section title="Acknowledgments" numbered="no" anchor="acknowledgments"><t>
   The authors would like to thank Thierry Couture for the discussions
   on the use-cases for Performance Measurement in Segment Routing.  The authors
   would also like to thank Greg Mirsky for reviewing this document and
   providing useful comments and suggestions.</t>

	</section>

	</back>

	</rfc>
