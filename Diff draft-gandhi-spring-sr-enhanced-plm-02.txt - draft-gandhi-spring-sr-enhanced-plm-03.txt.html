	<
<https://tools.ietf.org/rfcdiff?url2=draft-gandhi-spring-sr-enhanced-plm-02.txt> draft-gandhi-spring-sr-enhanced-plm-02.txt
<https://tools.ietf.org/html/draft-gandhi-spring-sr-enhanced-plm-02.txt> 	
 draft-gandhi-spring-sr-enhanced-plm-03.txt
<https://tools.ietf.org/html/draft-gandhi-spring-sr-enhanced-plm-03.txt> >
<https://tools.ietf.org/rfcdiff?url1=draft-gandhi-spring-sr-enhanced-plm-03.txt>

		 		
	SPRING Working Group                                      R. Gandhi, Ed.	 	SPRING Working Group                                      R. Gandhi, Ed.	
	Internet-Draft                                               C. Filsfils	 	Internet-Draft                                               C. Filsfils	
	Intended status: Standards Track                     Cisco Systems, Inc.	 	Intended status: Standards Track                     Cisco Systems, Inc.	
	Expires: January 12, 2021                                   N. Vaghamshi	 	Expires: March 23, 2021                                     N. Vaghamshi	
	                                                                Reliance	 	                                                                Reliance	
	                                                            M. Nagarajah	 	                                                            M. Nagarajah	
	                                                                 Telstra	 	                                                                 Telstra	
	                                                                R. Foote	 	                                                                R. Foote	
	                                                                   Nokia	 	                                                                   Nokia	
	                                                           July 11, 2020	 	                                                      September 19, 2020	
		 		
	 Enhanced Performance Delay and Liveness Monitoring in Segment Routing	 	 Enhanced Performance Delay and Liveness Monitoring in Segment Routing	
	                                Networks	 	                                Networks	
	                 draft-gandhi-spring-sr-enhanced-plm-02	 	                 draft-gandhi-spring-sr-enhanced-plm-03	
		 		
	Abstract	 	Abstract	
		 		
	   Segment Routing (SR) leverages the source routing paradigm.  SR is	 	   Segment Routing (SR) leverages the source routing paradigm.  SR is	
	   applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6	 	   applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6	
	   (SRv6) data planes.  This document defines procedure for Enhanced	 	   (SRv6) data planes.  This document defines procedure for Enhanced	
	   Performance Delay and Liveness Monitoring (PDLM) in Segment Routing	 	   Performance Delay and Liveness Monitoring (PDLM) in Segment Routing	
	   networks.  The procedure uses the probe messages defined in RFC 5357	 	   networks.  The procedure leverages the probe messages compatible with	
	   (Two-Way Active Measurement Protocol (TWAMP) Light) and RFC 8762	 	   the delay measurement message formats defined in RFC 5357 (Two-Way	
	   (Simple Two-Way Active Measurement Protocol (STAMP)) for end-to-end	 	   Active Measurement Protocol (TWAMP) Light) and RFC 8762 (Simple Two-	
	   SR Paths including SR Policies with both SR-MPLS and SRv6 data	 	   Way Active Measurement Protocol (STAMP)) and is applicable to end-to-	
		 	   end SR Paths including SR Policies for both SR-MPLS and SRv6 data	
	   planes.	 	   planes.	
		 		
	Status of This Memo	 	Status of This Memo	
		 		
	   This Internet-Draft is submitted in full conformance with the	 	   This Internet-Draft is submitted in full conformance with the	
	   provisions of BCP 78 and BCP 79.	 	   provisions of BCP 78 and BCP 79.	
		 		
	   Internet-Drafts are working documents of the Internet Engineering	 	   Internet-Drafts are working documents of the Internet Engineering	
	   Task Force (IETF).  Note that other groups may also distribute	 	   Task Force (IETF).  Note that other groups may also distribute	
	   working documents as Internet-Drafts.  The list of current Internet-	 	   working documents as Internet-Drafts.  The list of current Internet-	
	   Drafts is at https://datatracker.ietf.org/drafts/current/.	 	   Drafts is at https://datatracker.ietf.org/drafts/current/.	
		 		
	   Internet-Drafts are draft documents valid for a maximum of six months	 	   Internet-Drafts are draft documents valid for a maximum of six months	
	   and may be updated, replaced, or obsoleted by other documents at any	 	   and may be updated, replaced, or obsoleted by other documents at any	
	   time.  It is inappropriate to use Internet-Drafts as reference	 	   time.  It is inappropriate to use Internet-Drafts as reference	
	   material or to cite them other than as "work in progress."	 	   material or to cite them other than as "work in progress."	
		 		
	   This Internet-Draft will expire on January 12, 2021.	 	   This Internet-Draft will expire on March 23, 2021.	
		 		
	Copyright Notice	 	Copyright Notice	
		 		
	   Copyright (c) 2020 IETF Trust and the persons identified as the	 	   Copyright (c) 2020 IETF Trust and the persons identified as the	
	   document authors.  All rights reserved.	 	   document authors.  All rights reserved.	
		 		
	   This document is subject to BCP 78 and the IETF Trust's Legal	 	   This document is subject to BCP 78 and the IETF Trust's Legal	
	   Provisions Relating to IETF Documents	 	   Provisions Relating to IETF Documents	
	   (https://trustee.ietf.org/license-info) in effect on the date of	 	   (https://trustee.ietf.org/license-info) in effect on the date of	
	   publication of this document.  Please review these documents	 	   publication of this document.  Please review these documents	
		 		
	skipping to change at/page 2, line 27¶/ <#part-2>		skipping to change
at/page 2, line 27¶/ <#part-2>	
	   the Trust Legal Provisions and are provided without warranty as	 	   the Trust Legal Provisions and are provided without warranty as	
	   described in the Simplified BSD License.	 	   described in the Simplified BSD License.	
		 		
	Table of Contents	 	Table of Contents	
		 		
	   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3	 	   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3	
	   2.  Conventions Used in This Document . . . . . . . . . . . . . .   4	 	   2.  Conventions Used in This Document . . . . . . . . . . . . . .   4	
	     2.1.  Requirements Language . . . . . . . . . . . . . . . . . .   4	 	     2.1.  Requirements Language . . . . . . . . . . . . . . . . . .   4	
	     2.2.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   4	 	     2.2.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   4	
	     2.3.  Reference Topology  . . . . . . . . . . . . . . . . . . .   5	 	     2.3.  Reference Topology  . . . . . . . . . . . . . . . . . . .   5	
	     2.4.  Loopback Mode . . . . . . . . . . . . . . . . . . . . . .   5	 	   3.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . . .   5	
	   3.  Probe Messages  . . . . . . . . . . . . . . . . . . . . . . .   5	 	     3.1.  Loopback Mode . . . . . . . . . . . . . . . . . . . . . .   5	
	     3.1.  Example Provisioning Model  . . . . . . . . . . . . . . .   6	 	     3.2.  Loopback Mode Enabled with Network Programming Function .   6	
	   4.  Performance Delay and Liveness Monitoring . . . . . . . . . .   7	 	     3.3.  Example Provisioning Model  . . . . . . . . . . . . . . .   6	
	     4.1.  Probe Message for SR-MPLS . . . . . . . . . . . . . . . .   7	 	   4.  Probe Message Formats . . . . . . . . . . . . . . . . . . . .   7	
	     4.2.  Probe Message for SRv6  . . . . . . . . . . . . . . . . .   8	 	   5.  Performance Delay and Liveness Monitoring . . . . . . . . . .   9	
	   5.  Enhanced Performance Delay and Liveness Monitoring  . . . . .   9	 	     5.1.  Probe Message for SR-MPLS . . . . . . . . . . . . . . . .   9	
	     5.1.  Loopback Mode Enabled with Network Programming  . . . . .   9	 	     5.2.  Probe Message for SRv6  . . . . . . . . . . . . . . . . .  10	
	     5.2.  Probe Message with Network Programming for SR-MPLS  . . .  10	 	   6.  Enhanced Performance Delay and Liveness Monitoring  . . . . .  11	
	       5.2.1.  Node Capability for Timestamp Label . . . . . . . . .  11	 	     6.1.  Probe Message with Timestamp Label for SR-MPLS  . . . . .  11	
	       5.2.2.  Timestamp Label Allocation  . . . . . . . . . . . . .  11	 	       6.1.1.  Timestamp Label Allocation  . . . . . . . . . . . . .  12	
	     5.3.  Probe Message with Network Programming for SRv6 . . . . .  12	 	       6.1.2.  Node Capability for Timestamp Label . . . . . . . . .  13	
	   6.  ECMP Handling . . . . . . . . . . . . . . . . . . . . . . . .  13	 	     6.2.  Probe Message with Timestamp Endpoint Function for SRv6 .  13	
	   7.  Failure Notification  . . . . . . . . . . . . . . . . . . . .  13	 	       6.2.1.  Timestamp Endpoint Function Assignment  . . . . . . .  14	
	   8.  Security Considerations . . . . . . . . . . . . . . . . . . .  14	 	       6.2.2.  Node Capability for Timestamp Endpoint Function . . .  14	
	   9.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  14	 	   7.  ECMP Handling . . . . . . . . . . . . . . . . . . . . . . . .  15	
	   10. References  . . . . . . . . . . . . . . . . . . . . . . . . .  15	 	   8.  Failure Notification  . . . . . . . . . . . . . . . . . . . .  15	
	     10.1.  Normative References . . . . . . . . . . . . . . . . . .  15	 	   9.  Security Considerations . . . . . . . . . . . . . . . . . . .  15	
	     10.2.  Informative References . . . . . . . . . . . . . . . . .  15	 	   10. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  16	
	   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  17	 	   11. References  . . . . . . . . . . . . . . . . . . . . . . . . .  16	
	   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  17	 	     11.1.  Normative References . . . . . . . . . . . . . . . . . .  16	
		 	     11.2.  Informative References . . . . . . . . . . . . . . . . .  17	
		 	   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  18	
		 	   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  18	
		 		
	1.  Introduction	 	1.  Introduction	
		 		
	   Segment Routing (SR) leverages the source routing paradigm and	 	   Segment Routing (SR) leverages the source routing paradigm and	
	   greatly simplifies network operations for Software Defined Networks	 	   greatly simplifies network operations for Software Defined Networks	
	   (SDNs).  SR is applicable to both Multiprotocol Label Switching (SR-	 	   (SDNs).  SR is applicable to both Multiprotocol Label Switching (SR-	
	   MPLS) and IPv6 (SRv6) data planes [RFC8402].  SR takes advantage of	 	   MPLS) and IPv6 (SRv6) data planes [RFC8402].  SR takes advantage of	
	   the Equal-Cost Multipaths (ECMPs) between source and transit nodes,	 	   the Equal-Cost Multipaths (ECMPs) between source and transit nodes,	
	   between transit nodes and between transit and destination nodes.  SR	 	   between transit nodes and between transit and destination nodes.  SR	
	   Policies as defined in [I-D.ietf-spring-segment-routing-policy] are	 	   Policies as defined in [I-D.ietf-spring-segment-routing-policy] are	
	   used to steer traffic through a specific, user-defined paths using a	 	   used to steer traffic through a specific, user-defined paths using a	
	   stack of Segments.  Built-in Liveness Monitoring for detecting faults	 	   stack of Segments.  Built-in Performance Delay Measurement (DM) as	
	   as well as Performance Delay Measurement (DM) and Loss Measurement	 	   well as Liveness Monitoring for Connectivity Verification (CV) and	
	   (LM) are essential requirements to provide Service Level Agreements	 	   Continuity Check (CC) are essential requirements to provide Service	
	   (SLAs) in SR networks.	 	   Level Agreements (SLAs) in SR networks.	
		 		
	   The One-Way Active Measurement Protocol (OWAMP) defined in [RFC4656]	 	   The One-Way Active Measurement Protocol (OWAMP) defined in [RFC4656]	
	   and Two-Way Active Measurement Protocol (TWAMP) defined in [RFC5357]	 	   and Two-Way Active Measurement Protocol (TWAMP) defined in [RFC5357]	
	   provide capabilities for the measurement of various performance	 	   provide capabilities for the measurement of various performance	
	   metrics in IP networks using probe messages.  The TWAMP Light	 	   metrics in IP networks using probe messages.  The TWAMP Light	
	   [Appendix I in RFC5357] and the Simple Two-way Active Measurement	 	   [Appendix I in RFC5357] and the Simple Two-way Active Measurement	
	   Protocol (STAMP) [RFC8762] provide simplified mechanisms for active	 	   Protocol (STAMP) [RFC8762] provide simplified mechanisms for active	
	   performance measurement in IP networks, alleviating the need for	 	   performance measurement in IP networks, alleviating the need for	
	   control-channel signaling by using configuration data model to	 	   control-channel signaling by using configuration data model to	
	   provision a test-channel.	 	   provision a test-channel.	
		 		
	skipping to change at/page 4, line 7¶/ <#part-3>		skipping to change
at/page 4, line 7¶/ <#part-3>	
	   in order to send the reply thereby limiting the scale for number of	 	   in order to send the reply thereby limiting the scale for number of	
	   PM sessions and fault detection interval.  In addition, S-BFD	 	   PM sessions and fault detection interval.  In addition, S-BFD	
	   protocol does not have the capability today to enable performance	 	   protocol does not have the capability today to enable performance	
	   delay monitoring in SR networks.  Enabling multiple protocols in SR	 	   delay monitoring in SR networks.  Enabling multiple protocols in SR	
	   networks, S-BFD for liveness monitoring and TWAMP Light or STAMP for	 	   networks, S-BFD for liveness monitoring and TWAMP Light or STAMP for	
	   performance delay monitoring increases the deployment and operational	 	   performance delay monitoring increases the deployment and operational	
	   complexities in SR networks.	 	   complexities in SR networks.	
		 		
	   This document defines procedure for Enhanced Performance Delay and	 	   This document defines procedure for Enhanced Performance Delay and	
	   Liveness Monitoring (PDLM) in Segment Routing networks.  The	 	   Liveness Monitoring (PDLM) in Segment Routing networks.  The	
	   procedure uses the probe messages defined in [RFC5357] (TWAMP Light)	 	   procedure leverages the probe messages compatible with the delay	
	   and [RFC8762] (STAMP) for end-to-end SR Paths including SR Policies	 	   measurement message formats defined in RFC 5357 (Two-Way Active	
	   with both SR-MPLS and SRv6 data planes.	 	   Measurement Protocol (TWAMP) Light) and RFC 8762 (Simple Two-Way	
		 	   Active Measurement Protocol (STAMP)) and is applicable to end-to-end	
		 	   SR Paths including SR Policies for both SR-MPLS and SRv6 data planes.	
		 		
	2.  Conventions Used in This Document	 	2.  Conventions Used in This Document	
		 		
	2.1.  Requirements Language	 	2.1.  Requirements Language	
		 		
	   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",	 	   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",	
	   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this	 	   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this	
	   document are to be interpreted as described in [RFC2119] [RFC8174]	 	   document are to be interpreted as described in [RFC2119] [RFC8174]	
	   when, and only when, they appear in all capitals, as shown here.	 	   when, and only when, they appear in all capitals, as shown here.	
		 		
		 		
	skipping to change at/page 5, line 11¶/ <#part-4>		skipping to change
at/page 5, line 13¶/ <#part-4>	
	   SR-MPLS: Segment Routing with MPLS data plane.	 	   SR-MPLS: Segment Routing with MPLS data plane.	
		 		
	   SRv6: Segment Routing with IPv6 data plane.	 	   SRv6: Segment Routing with IPv6 data plane.	
		 		
	   STAMP: Simple Two-way Active Measurement Protocol.	 	   STAMP: Simple Two-way Active Measurement Protocol.	
		 		
	   TWAMP: Two-Way Active Measurement Protocol.	 	   TWAMP: Two-Way Active Measurement Protocol.	
		 		
	2.3.  Reference Topology	 	2.3.  Reference Topology	
		 		
	   In the reference topology shown below, the nodes R1 and R5 are	 	   In the reference topology shown in Figure 1, the nodes R1 and R5 are	
	   connected via Point-to-Point (P2P) SR Path such as SR Policy	 	   connected via Point-to-Point (P2P) SR Path such as SR Policy	
	   [I-D.ietf-spring-segment-routing-policy] originating on node R1 with	 	   [I-D.ietf-spring-segment-routing-policy] originating on node R1 with	
	   endpoint on node R5.	 	   endpoint on node R5.	
		 		
	                            t1	 	                            t1	
	                           /	 	                           /	
	                  +-------+      Probe          +-------+	 	                  +-------+      Probe          +-------+	
	                  |       | - - - - - - - - - - |       |	 	                  |       | - - - - - - - - - - |       |	
	                  |   R1  |====================||  R5   |	 	                  |   R1  |====================||  R5   |	
	                  |       |<- - - - - - - - - - |       |	 	                  |       |<- - - - - - - - - - |       |	
	                  +-------+      Return Probe   +-------+	 	                  +-------+      Return Probe   +-------+	
	                           \	 	                           \	
	                            t4	 	                            t4	
	                   Sender                       Reflector	 	                   Sender                       Reflector	
	                                                (Simply Forward)	 	                                                (Simply Forward)	
		 		
	                       Figure 1: Reference Topology	 	                       Figure 1: Reference Topology	
		 		
	2.4.  Loopback Mode	 	3.  Overview	
		 		
		 	3.1.  Loopback Mode	
		 		
	   In loopback mode, the sender node R1 initiates probe messages and the	 	   In loopback mode, the sender node R1 initiates probe messages and the	
	   reflector node R5 forwards them back to the sender node R1 just like	 	   reflector node R5 forwards them just like data packets for the normal	
	   data packets for the normal traffic.  The probe messages are not	 	   traffic back to the sender node R1.  The probe messages are not	
	   punted at the reflector node and it does not process them and	 	   punted at the reflector node and it does not process them and	
	   generate response messages.  The reflector node must not drop the	 	   generate response messages.  The reflector node must not drop the	
	   loopback probe messages, for example, due to a local policy	 	   loopback probe messages, for example, due to a local policy	
	   provisioned on the node.	 	   provisioned on the node.  No PM session is created on the reflector	
		 	   node.	
		 		
	3.  Probe Messages	 	   The Source and Destination IP addresses in the probe messages are set	
		 	   to the reflector and the sender node addresses, respectively	
		 	   (representing the reverse path).  Both Source and Destination UDP	
		 	   ports in the probe messages are allocated dynamically or user-	
		 	   configured from the range specified in [RFC8762].  The UDP ports used	
		 	   in loopback mode are different than the ports used for TWAMP Light	
		 	   and STAMP sessions.  The IPv4 Time To Live (TTL) and IPv6 Hop Limit	
		 	   (HL) are set to 255.	
		 		
	   The TWAMP Light probe messages for delay measurement as defined in	 	3.2.  Loopback Mode Enabled with Network Programming Function	
	   [RFC5357] or STAMP probe messages as defined in [RFC8762] are sent by	 		
	   the sender node R1 towards the reflector node R5 in loopback mode as	 		
	   shown in Figure 1.  The probe messages are sent by the sender node on	 		
	   the congruent path of the data traffic flowing on the SR Path.	 		
		 		
	   Both Source and Destination UDP ports in the probe messages are	 	   In "loopback mode enabled with network programming function", both	
	   allocated dynamically or user-configured from the range specified in	 	   transmit (t1) and receive (t2) timestamps in data plane are collected	
	   [RFC8762] and are different than the ports used for TWAMP Light and	 	   by the probe messages sent in loopback mode as shown in Figure 2.	
	   STAMP sessions.  The Source and Destination IP addresses in the probe	 	   The network programming function optimizes the "operations of punt	
	   messages are set to the reflector and the sender node addresses,	 	   and inject the probe packet" on the reflector node as timestamping is	
	   respectively (representing the reverse path).  The IPv4 Time To Live	 	   implemented in hardware.  This helps to achieve higher scale and	
	   (TTL) and IPv6 Hop Limit (HL) are set to 255.	 	   faster rate, resulting in faster failure detection.	
		 		
	   No PM session is created on the reflector node R5.  As the probe	 	                            t1                t2	
	   message is not punted on the reflector node for processing, the	 	                           /                   \	
	   Sender copies the 'Sequence Number' in 'Session-Sender Sequence	 	                  +-------+      Probe          +-------+	
	   Number' field directly.  Also, the Sender Timestamp, Sender Error	 	                  |       | - - - - - - - - - - |       |	
	   Estimate and Sender TTL fields [RFC5357] [RFC8762] in the probe	 	                  |   R1  |====================||  R5   |	
	   message are not used.  The rest of the fields are set as defined in	 	                  |       |<- - - - - - - - - - |       |	
	   [RFC5357] [RFC8762]	 	                  +-------+      Return Probe   +-------+	
		 	                   Sender                       Reflector	
		 	                                                (Timestamp,	
		 	                                                 Pop and Forward)	
		 		
	   Timestamp format preferred is 64-bit PTPv2 [IEEE1588] as specified in	 	     Figure 2: Loopback Mode Enabled with Network Programming Function	
	   [RFC8186], implemented in hardware.  The NTP timestamp format MUST be	 		
	   supported [RFC5357], however, since PTPv2 is widely used, it SHOULD	 		
	   also be supported.  In addition to adding the timestamp in the	 		
	   message, the "Error Estimate" field in the payload of the message can	 		
	   be updated using the procedure defined in [RFC4656].	 		
		 		
	3.1.  Example Provisioning Model	 	   The sender node adds transmit (t1) timestamp in the payload of the	
		 	   probe message and clears the receive (t2) timestamp.  The reflector	
		 	   node adds the receive timestamp in the payload of the received probe	
		 	   message in hardware without punting the message to slow-path (or	
		 	   control-plane).  The reflector node only adds the receive timestamp	
		 	   if the source or destination address in the probe message matches the	
		 	   local node address to ensure that the probe message reaches the	
		 	   intended reflector node and the receive timestamp is returned by the	
		 	   that node.  The payload of the probe message is not modified by any	
		 	   intermediate nodes.	
		 		
		 	   The network programming function enables the node to add receive	
		 	   timestamp in the payload of the probe message at a specific offset	
		 	   which is locally provisioned consistently in the network.  In the	
		 	   probe message defined in Figure 4 for delay measurement, the 64-bit	
		 	   receive timestamp is added at byte-offset 16 which is from the start	
		 	   of the payload.	
		 		
		 	3.3.  Example Provisioning Model	
		 		
	   An example provisioning model and typical measurement parameters are	 	   An example provisioning model and typical measurement parameters are	
	   shown in Figure 2:	 	   shown in Figure 3:	
		 		
	                               +------------+	 	                               +------------+	
	                               | Controller |	 	                               | Controller |	
	                               +------------+	 	                               +------------+	
	     PDLM Mode                     /    \      Network Programming Label	 	     PDLM Mode                     /    \      Timestamp Label/SRV6 EP	
	       LB or Enhanced Mode        /      \       Timestamp2 Offset	 	       LB or Enhanced Mode        /      \       Timestamp2 Offset	
	     Measurement Protocol        /        \    Timestamp Format	 	     Message Format              /        \      Timestamp Format	
	     Missed Probe Message Count /          \	 	     Missed Probe Message Count /          \	
	     Network Programming Label /            \	 	     Timestamp Label/SRv6 EP   /            \	
	     Timestamp Format         /              \	 	       Timestamp Format       /              \	
	     Delay Threshold/Count   /                \	 	     Delay Threshold/Count   /                \	
	     Source/Dest UDP Ports  /                  \	 	     Source/Dest UDP Ports  /                  \	
	                           v                    v	 	                           v                    v	
	                       +-------+            +-------+	 	                       +-------+            +-------+	
	                       |       |            |       |	 	                       |       |            |       |	
	                       |   R1  |============|   R5  |	 	                       |   R1  |============|   R5  |	
	                       |       |  SR Path   |       |	 	                       |       |  SR Path   |       |	
	                       +-------+            +-------+	 	                       +-------+            +-------+	
	                        Sender              Reflector	 	                        Sender              Reflector	
		 		
	                   Figure 2: Example Provisioning Model	 	                   Figure 3: Example Provisioning Model	
		 		
	   Example of Measurement Protocol is TWAMP Light and STAMP, example of	 	   Example of message format is TWAMP Light and STAMP, example of	
	   Timestamp Format is 64-bit PTPv2 [IEEE1588] and NTP, etc.	 	   Timestamp Format is 64-bit PTPv2 [IEEE1588] and NTP, etc.	
		 		
	   The mechanisms to provision the sender and reflector nodes are	 	   The mechanisms to provision the sender and reflector nodes are	
	   outside the scope of this document.	 	   outside the scope of this document.	
		 		
	4.  Performance Delay and Liveness Monitoring	 	4.  Probe Message Formats	
		 		
		 	   The probe messages compatible with the delay measurement message	
		 	   formats defined in TWAMP [RFC5357] and STAMP [RFC8762] are specified	
		 	   in Figure 4.	
		 		
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Sequence Number                           |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Transmit Timestamp (t1)                   |	
		 	     |                                                               |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |  Error Estimate               |  MBZ                          |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Receive Timestamp (t2)                    |	
		 	     |                                                               |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     .                                                               .	
		 	     .                     Variable Length Padding                   .	
		 	     ~                                                               ~	
		 	     .                                                               .	
		 	     .                                                               .	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 		
		 	                   TWAMP Compatible Probe Packet Format	
		 		
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Sequence Number                           |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Transmit Timestamp (t1)                   |	
		 	     |                                                               |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |  Error Estimate               |  SSID                         |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                     Receive Timestamp (t2)                    |	
		 	     |                                                               |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |                                                               |	
		 	     |                     Fixed Length Padding                      |	
		 	     |                                                               |	
		 	     |                                                               |	
		 	     |                                                               |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 		
		 	                   STAMP Compatible Probe Packet Format	
		 		
		 	                      Figure 4: Probe Packet Formats	
		 		
		 	   Timestamp format preferred is 64-bit PTPv2 [IEEE1588] as specified in	
		 	   [RFC8186], implemented in hardware.  In addition to adding the	
		 	   timestamp in the message, the "Error Estimate" field in the payload	
		 	   of the message can be updated using the procedure defined in	
		 	   [RFC4656].	
		 		
		 	5.  Performance Delay and Liveness Monitoring	
		 		
	   For performance delay and liveness monitoring of an end-to-end SR	 	   For performance delay and liveness monitoring of an end-to-end SR	
	   Path including SR Policy, PM probes in loopback mode is used.  The PM	 	   Path including SR Policy, PM probes in loopback mode is used.	
	   probe messages are sent by the sender (head-end) node R1 to the	 		
	   reflector (endpoint) node R5 of the SR Policy as shown in Figure 1.	 		
		 		
	   The probe messages are sent using the Segment List (SL) of the	 	   For SR Policy, the probe messages are sent using the Segment List	
	   Candidate-paths of the SR Policy	 	   (SL) of the Candidate-path [I-D.ietf-spring-segment-routing-policy].	
	   [I-D.ietf-spring-segment-routing-policy].  When a Candidate-path has	 	   When a Candidate-path has more than one Segment Lists, multiple probe	
	   more than one Segment Lists, multiple probe messages are sent, one	 	   messages are sent, one using each Segment List.  The return probe	
	   using each Segment List.  The return probe messages are received by	 	   messages are received by the sender node via IP/UDP [RFC0768] return	
	   the sender node via IP/UDP [RFC0768] return path by default.  The	 	   path by default.  The Segment List of the return SR path can be added	
	   Segment List of the return SR path can be added in the probe message	 	   in the probe message header to receive the return probe message on a	
	   header to receive the return probe message on a specific path using	 	   specific path using the Binding SID [I-D.ietf-pce-binding-label-sid]	
	   the mechanisms defined in [I-D.ietf-pce-binding-label-sid] and	 	   or Segment List of the Reverse SR Policy	
	   [I-D.ietf-pce-sr-bidir-path].	 	   [I-D.ietf-pce-sr-bidir-path].	
		 		
	4.1.  Probe Message for SR-MPLS	 	5.1.  Probe Message for SR-MPLS	
		 		
	   The TWAMP Light or STAMP probe messages for SR-MPLS data plane are	 	   The probe messages are sent using the MPLS header containing the	
	   sent using the MPLS header containing the label stack of the SR	 	   label stack of the SR Policy as shown in Figure 5.  In case of IP/UDP	
	   Policy as shown in Figure 3.  In case of IP/UDP return path, the MPLS	 	   return path, the MPLS header is removed by the reflector node.  The	
	   header is removed by the reflector node.  The label stack can contain	 	   label stack can contain a reverse SR-MPLS path to receive the return	
	   a reverse SR-MPLS path to receive the return probe message on a	 	   probe message on a specific path.  In this case, the MPLS header will	
	   specific path.  In this case, the MPLS header will not be removed by	 	   not be removed by the reflector node.	
	   the reflector node.	 		
		 		
	     0                   1                   2                   3	 	     0                   1                   2                   3	
	     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1	 	     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     |            Label(1)                   | TC  |S|      TTL      |	 	     |            Label(1)                   | TC  |S|      TTL      |	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     .                                                               .	 	     .                                                               .	
	     .                                                               .	 	     .                                                               .	
	     .                                                               .	 	     .                                                               .	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 		
	skipping to change at/page 8, line 27¶/ <#part-5>		skipping to change
at/page 10, line 27¶/ <#part-5>	
	     .  Source IP Address = Reflector IPv4 or IPv6 Address           .	 	     .  Source IP Address = Reflector IPv4 or IPv6 Address           .	
	     .  Destination IP Address = Sender IPv4 or IPv6 Address         .	 	     .  Destination IP Address = Sender IPv4 or IPv6 Address         .	
	     .  Protocol = UDP                                               .	 	     .  Protocol = UDP                                               .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | UDP Header                                                    |	 	     | UDP Header                                                    |	
	     .  Source Port = As chosen by Sender                            .	 	     .  Source Port = As chosen by Sender                            .	
	     .  Destination Port = As chosen by Sender                       .	 	     .  Destination Port = As chosen by Sender                       .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     |  Payload as defined in Section 4.2.1 of RFC 5357 |            |	 	     |  Payload as defined in Figure 4                               |	
	     |  Payload as defined in Section 4.2 of RFC 8762                |	 		
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
		 		
	                Figure 3: Example Probe Message for SR-MPLS	 	                Figure 5: Example Probe Message for SR-MPLS	
		 		
	4.2.  Probe Message for SRv6	 	5.2.  Probe Message for SRv6	
		 		
	   The TWAMP Light or STAMP probe messages for SRv6 data plane are sent	 	   The probe messages for SRv6 data plane are sent using the Segment	
	   using the Segment Routing Header (SRH) [RFC8754] containing the	 	   Routing Header (SRH) [RFC8754] containing the Segment List of the SR	
	   Segment List of the SR Policy as shown in Figure 4.  In case of IP/	 	   Policy as shown in Figure 6.  In case of IP/UDP return path, the SRH	
	   UDP return path, the SRH is removed by the reflector node.  The	 	   is removed by the reflector node.  The Segment List can contain a	
	   Segment List can contain a reverse SRv6 path to receive the return	 	   reverse SRv6 path to receive the return probe message on a specific	
	   probe message on a specific path.  In this case, the SRH will not be	 	   path.  In this case, the SRH will not be removed by the reflector	
	   removed by the reflector node.	 	   node.  When the return probe message contains an SRH at the sender	
		 	   node, the procedure defined for upper-layer header processing for	
		 	   SRv6 SIDs in [I-D.ietf-spring-srv6-network-programming] is used to	
		 	   process the UDP header in the received probe messages.	
		 		
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | IP Header                                                     |	 	     | IP Header                                                     |	
	     .  Source IP Address = Sender IPv6 Address                      .	 	     .  Source IP Address = Sender IPv6 Address                      .	
	     .  Destination IP Address = Destination IPv6 Address            .	 	     .  Destination IP Address = Destination IPv6 Address            .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | SRH as specified in RFC 8754                                  |	 	     | SRH as specified in RFC 8754                                  |	
	     .     <Segment List>                                            .	 	     .     <Segment List>                                            .	
	     .                                                               .	 	     .                                                               .	
		 		
	skipping to change at/page 9, line 25¶/ <#part-6>		skipping to change
at/page 11, line 25¶/ <#part-6>	
	     | IP Header                                                     |	 	     | IP Header                                                     |	
	     .  Source IP Address = Reflector IPv6 Address                   .	 	     .  Source IP Address = Reflector IPv6 Address                   .	
	     .  Destination IP Address = Sender IPv6 Address                 .	 	     .  Destination IP Address = Sender IPv6 Address                 .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | UDP Header                                                    |	 	     | UDP Header                                                    |	
	     .  Source Port = As chosen by Sender                            .	 	     .  Source Port = As chosen by Sender                            .	
	     .  Destination Port = As chosen by Sender                       .	 	     .  Destination Port = As chosen by Sender                       .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     |  Payload as defined in Section 4.2.1 of RFC 5357 |            |	 	     |  Payload as defined in Figure 4                               |	
	     |  Payload as defined in Section 4.2 of RFC 8762                |	 		
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
		 		
	                 Figure 4: Example Probe Message for SRv6	 	                 Figure 6: Example Probe Message for SRv6	
		 		
	5.  Enhanced Performance Delay and Liveness Monitoring	 	6.  Enhanced Performance Delay and Liveness Monitoring	
		 		
	   The enhanced performance delay and liveness monitoring of an end-to-	 	   The enhanced performance delay and liveness monitoring of an end-to-	
	   end SR Path including SR Policy is defined using the PM probes in	 	   end SR Path including SR Policy is defined using the PM probes in	
	   "loopback mode enabled with network programming".	 	   "loopback mode enabled with network programming function".	
		 		
	5.1.  Loopback Mode Enabled with Network Programming	 		
		 		
	   In "loopback mode enabled with network programming", both transmit	 		
	   (t1) and receive (t2) timestamps in data plane are collected by the	 		
	   probe messages sent in loopback mode as shown in Figure 5.  The	 		
	   network programming function optimizes the "operations of punt, add	 		
	   receive timestamp and inject the probe packet" on the reflector node	 		
	   and it is implemented in hardware.  The payload of the probe message	 		
	   is not modified by any intermediate nodes.	 		
		 		
	                            t1                t2	 		
	                           /                   \	 		
	                  +-------+      Probe          +-------+	 		
	                  |       | - - - - - - - - - - |       |	 		
	                  |   R1  |====================||  R5   |	 		
	                  |       |<- - - - - - - - - - |       |	 		
	                  +-------+      Return Probe   +-------+	 		
	                   Sender                       Reflector	 		
	                                                (Timestamp,	 		
	                                                 Pop and Forward)	 		
		 		
	         Figure 5: Loopback Mode Enabled with Network Programming	 		
		 		
	   The sender node adds transmit (t1) timestamp in the payload of the	 		
	   TWAMP Light or STAMP probe message and clears the receive (t2)	 		
	   timestamp.  The reflector node adds the receive timestamp in the	 		
	   payload of the received probe message without punting the message to	 		
	   slow-path (or control-plane).  The reflector node only adds the	 		
	   receive timestamp if the source or destination address in the probe	 		
	   message matches the local node address to ensure that the receive	 		
	   timestamp is returned by the intended reflector node.	 		
		 		
	   The network programming function enables the node to add receive	 		
	   timestamp in the payload of the probe message at a specific offset	 		
	   which is locally provisioned consistently in the network.  In TWAMP	 		
	   Light message defined in Section 4.2.1 of [RFC5357] or STAMP message	 		
	   defined in [RFC8762] for delay measurement, the 64-bit receive	 		
	   timestamp is added at byte-offset 16 which is from the start of the	 		
	   payload.	 		
		 		
	5.2.  Probe Message with Network Programming for SR-MPLS	 	6.1.  Probe Message with Timestamp Label for SR-MPLS	
		 		
	   In this document, new Timestamp Label (value TBD1) is defined for SR-	 	   In this document, new Timestamp Label (value TBD1) is defined for SR-	
	   MPLS data plane to enable network programming function for	 	   MPLS data plane to enable network programming function for	
	   "timestamp, pop and forward" the received packet.	 	   "timestamp, pop and forward" the received packet.	
		 		
	   In the probe message for SR-MPLS, Timestamp Label is added in the	 	   In the probe message for SR-MPLS, Timestamp Label is added in the	
	   MPLS header as shown in Figure 6, to collect "Receive Timestamp"	 	   MPLS header as shown in Figure 7, to collect "Receive Timestamp"	
	   field in the payload of the TWAMP Light [RFC5357] or STAMP probe	 	   field in the payload of the probe message.  The label stack for the	
	   message.  The label stack for the reverse SR-MPLS path can be added	 	   reverse SR-MPLS path can be added after the Timestamp Label to	
	   after the Timestamp Label to receive the return probe message on a	 	   receive the return probe message on a specific path.  When a node	
	   specific path.  When a node receives a message with Timestamp Label,	 	   receives a message with Timestamp Label, after timestamping the	
	   after timestamping the message at a specific offset, the node pops	 	   packet at a specific offset, the node pops the Timestamp Label and	
	   the Timestamp Label and forwards the message using the next label or	 	   forwards the message using the next label or IP header in the message	
	   IP header in the message (just like the data packets for the normal	 	   (just like the data packets for the normal traffic).	
	   traffic).	 		
		 		
	     0                   1                   2                   3	 	     0                   1                   2                   3	
	     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1	 	     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     |            Label(1)                   | TC  |S|      TTL      |	 	     |            Label(1)                   | TC  |S|      TTL      |	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     .                                                               .	 	     .                                                               .	
	     .                                                               .	 	     .                                                               .	
	     .                                                               .	 	     .                                                               .	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     |            Label(n)                   | TC  |S|      TTL      |	 	     |            Label(n)                   | TC  |S|      TTL      |	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
		 	     |            Extension Label (15)       | TC  |S|      TTL      |	
		 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     |            Timestamp Label (TBA1)     | TC  |S|      TTL      |	 	     |            Timestamp Label (TBA1)     | TC  |S|      TTL      |	
	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	 	     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+	
	     | IP Header                                                     |	 	     | IP Header                                                     |	
	     .  Source IP Address = Reflector IPv4 or IPv6 Address           .	 	     .  Source IP Address = Reflector IPv4 or IPv6 Address           .	
	     .  Destination IP Address = Sender IPv4 or IPv6 Address         .	 	     .  Destination IP Address = Sender IPv4 or IPv6 Address         .	
	     .  Protocol = UDP                                               .	 	     .  Protocol = UDP                                               .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | UDP Header                                                    |	 	     | UDP Header                                                    |	
	     .  Source Port = As chosen by Sender                            .	 	     .  Source Port = As chosen by Sender                            .	
	     .  Destination Port = As chosen by Sender                       .	 	     .  Destination Port = As chosen by Sender                       .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     |  Payload as defined in Section 4.2.1 of RFC 5357 Or           |	 	     |  Payload as defined in Figure 4                               |	
	     |  Payload as defined in Section 4.2 of RFC 8762                |	 		
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
		 		
	     Figure 6: Example Probe Message with Timestamp Label for SR-MPLS	 	     Figure 7: Example Probe Message with Timestamp Label for SR-MPLS	
	                                                                         	 		
	5.2.1.  Node Capability for Timestamp Label	 		
		 		
	   The ingress node needs to know if the egress node can process the	 		
	   Timestamp Label.  The signaling extension for this capability	 		
	   exchange is outside the scope of this document.	 		
		 		
	   Another way is to leverage a centralized controller (e.g., SDN	 		
	   controller) to program the ingress and egress nodes.  In this case,	 		
	   the controller MUST make sure (e.g., by some capability discovery	 		
	   mechanisms outside the scope of this document) that the egress node	 		
	   can process the Timestamp Label.	 		
		 		
	5.2.2.  Timestamp Label Allocation	 	6.1.1.  Timestamp Label Allocation	
		 		
	   Timestamp Label (value TBA1) can be allocated using one of the	 	   Timestamp Label (value TBA1) can be allocated using one of the	
	   following methods:	 	   following methods:	
		 		
	   o  Labels assigned by IANA with value TBA1 from the Extended Special-	 	   o  Label assigned by IANA from the "Extended Special-Purpose MPLS	
	      Purpose MPLS Values [I-D.ietf-mpls-spl-terminology].	 	      Values" [I-D.ietf-mpls-spl-terminology].  The timestamp offset is	
		 	      fixed at byte-offset 16 and timestamp format is PTPv2 for this	
		 	      label.	
		 		
	   o  Labels allocated by a Controller from the global table of the	 	   o  Label allocated by a Controller from the global table of the	
	      egress node.  The Controller provisions the label on both ingress	 	      egress node.  The Controller provisions the label on both ingress	
	      and egress nodes.	 	      and egress nodes, as well as timestamp offset and timestamp	
		 	      format.	
		 		
	   o  Labels allocated by the egress node.  The signaling or IGP	 	   o  Label allocated by the egress node.  The signaling and IGP	
	      flooding extension for this is outside the scope of this document.	 	      flooding extension for the label (including timestamp offset and	
		 	      timestamp format) are outside the scope of this document.	
		 		
	5.3.  Probe Message with Network Programming for SRv6	 	6.1.2.  Node Capability for Timestamp Label	
		 		
	   In this document, new Endpoint function "Timestamp and Forward (TSF)"	 	   The ingress node needs to know if the egress node can process the	
	   (value TBD2) is defined for Segment Routing Header (SRH) [RFC8754]	 	   Timestamp Label to avoid dropping probe packets.  The signaling	
	   for SRv6 data plane to enable network programming function for	 	   extension for this capability exchange is outside the scope of this	
	   "timestamp and forward" the received message.	 	   document.	
		 		
	   In the probe message for SRv6, END.TSF function is added for the	 	6.2.  Probe Message with Timestamp Endpoint Function for SRv6	
	   Endpoint Segment Identifier (SID) in SRH [RFC8754] as shown in	 		
	   Figure 7, to collect "Receive Timestamp" field in the payload of the	 	   In this document, Timestamp Endpoint function for "Timestamp and	
	   TWAMP Light [RFC5357] or STAMP probe message.  When a node receives a	 	   Forward (TSF)" (value TBD2) is defined for Segment Routing Header	
	   packet with END.TSF function for the target SID which is local, after	 	   (SRH) [RFC8754] for SRv6 data plane to enable network programming	
	   timestamping the packet at a specific offset, the node forwards the	 	   function to "timestamp and forward" the received packet.	
	   packet using the next SID or IP header in the packet (just like the	 	                                                                         	
	   packets for the normal traffic).	 	   In the probe message for SRv6, End.TSF function is added for the	
		 	   target Segment Identifier (SID) in SRH [RFC8754] as shown in	
		 	   Figure 8, to collect "Receive Timestamp" field in the payload of the	
		 	   probe message.  The Segment List for the reverse path can be added	
		 	   after the target SID to receive the return probe message on a	
		 	   specific path.  When a reflector node receives a message with End.TSF	
		 	   function for the target SID which is local, after timestamping the	
		 	   packet at a specific offset, the node forwards the packet using the	
		 	   next SID or IP header in the message (just like the data packets for	
		 	   the normal traffic).	
		 		
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | IP Header                                                     |	 	     | IP Header                                                     |	
	     .  Source IP Address = Sender IPv6 Address                      .	 	     .  Source IP Address = Sender IPv6 Address                      .	
	     .  Destination IP Address = Destination IPv6 Address            .	 	     .  Destination IP Address = Destination IPv6 Address            .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | SRH as specified in RFC 8754                                  |	 	     | SRH as specified in RFC 8754                                  |	
	     .     <Segment List>                                            .	 	     .     <Segment List>                                            .	
	     .                                                               .	 	     .                                                               .	
		 		
	skipping to change at/page 13, line 25¶/ <#part-7>		skipping to change
at/page 14, line 25¶/ <#part-7>	
	     | IP Header                                                     |	 	     | IP Header                                                     |	
	     .  Source IP Address = Reflector IPv6 Address                   .	 	     .  Source IP Address = Reflector IPv6 Address                   .	
	     .  Destination IP Address = Sender IPv6 Address                 .	 	     .  Destination IP Address = Sender IPv6 Address                 .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     | UDP Header                                                    |	 	     | UDP Header                                                    |	
	     .  Source Port = As chosen by Sender                            .	 	     .  Source Port = As chosen by Sender                            .	
	     .  Destination Port = As chosen by Sender                       .	 	     .  Destination Port = As chosen by Sender                       .	
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
	     |  Payload as defined in Section 4.2.1 of RFC 5357 Or           |	 	     |  Payload as defined in Figure 4                               |	
	     |  Payload as defined in Section 4.2 of RFC 8762                |	 		
	     .                                                               .	 	     .                                                               .	
	     +---------------------------------------------------------------+	 	     +---------------------------------------------------------------+	
		 		
	      Figure 7: Example Probe Message with Endpoint Function for SRv6	 	      Figure 8: Example Probe Message with Endpoint Function for SRv6	
		 		
	6.  ECMP Handling	 	6.2.1.  Timestamp Endpoint Function Assignment	
		 		
		 	   Timestamp endpoint function for "Timestamp and Forward" (value TBA2)	
		 	   can be signaled using one of the following methods:	
		 		
		 	   o  Timestamp endpoint function assigned by IANA from the "SRv6	
		 	      Endpoint Behaviors Registry".	
		 		
		 	   o  Timestamp endpoint function assigned by a Controller.  The	
		 	      Controller provisions the value on both ingress and egress nodes,	
		 	      as well as timestamp offset and timestamp format.	
		 		
		 	   o  Timestamp endpoint function assigned by the egress node.  The	
		 	      signaling and IGP flooding extension for the endpoint function	
		 	      (including timestamp offset and timestamp format) are outside the	
		 	      scope of this document.	
		 		
		 	6.2.2.  Node Capability for Timestamp Endpoint Function	
		 		
		 	   The ingress node needs to know if the egress node can process the	
		 	   Timestamp Endpoint Function to enable the monitoring.  The signaling	
		 	   extension for this capability exchange is outside the scope of this	
		 	   document.	
		 		
		 	7.  ECMP Handling	
		 		
	   An SR Policy can have ECMPs between the source and transit nodes,	 	   An SR Policy can have ECMPs between the source and transit nodes,	
	   between transit nodes and between transit and destination nodes.  The	 	   between transit nodes and between transit and destination nodes.  The	
	   PM probe messages need to be sent to traverse different ECMP paths to	 	   PM probe messages need to be sent to traverse different ECMP paths to	
	   monitor the liveness for an end-to-end SR Policy.	 	   monitor the liveness for an end-to-end SR Policy.	
		 		
	   Forwarding plane has various hashing functions available to forward	 	   Forwarding plane has various hashing functions available to forward	
	   packets on specific ECMP paths.  In IPv4 header of the PM probe	 	   packets on specific ECMP paths.  In IPv4 header of the PM probe	
	   messages, sweeping of Destination Address in 127/8 range can be used	 	   messages, sweeping of Destination Address in 127/8 range can be used	
	   to exercise different ECMP paths in the loopback mode as long as the	 	   to exercise different ECMP paths in the loopback mode as long as the	
	   return path is also SR-MPLS.  The Flow Label field in the outer IPv6	 	   return path is also SR-MPLS.  The Flow Label field in the outer IPv6	
	   header can also be used for sweeping to exercise different ECMP	 	   header can also be used for sweeping to exercise different ECMP	
	   paths.	 	   paths.	
		 		
	7.  Failure Notification	 	8.  Failure Notification	
		 	                                                                         	
		 	   Liveness success for SR Path is initially notified as soon as one or	
		 	   more return probe messages are received at the sender node.	
		 		
	   Liveness failure for SR Path is notified when consecutive N number of	 	   Liveness failure for SR Path is notified when consecutive N number of	
	   return probe messages are not received at the sender node, where N	 	   return probe messages are not received at the sender node, where N	
	   (Missed Probe Message Count) is locally provisioned value.	 	   (Missed Probe Message Count) is locally provisioned value.	
	   Similarly, delay metrics are notified when consecutive M number of	 	   Similarly, delay metrics are notified as an example when consecutive	
	   probe messages have measured delay values exceed user-configured	 	   M number of probe messages have measured delay values exceed user-	
	   thresholds (absolute and percentage), where M is also locally	 	   configured thresholds (absolute and percentage), where M is also	
	   provisioned value.	 	   locally provisioned value.	
		 		
	   In loopback mode, the timestamps t1 and t4 are used to measure round-	 	   In loopback mode, the timestamps t1 and t4 are used to measure round-	
	   trip delay.  In loopback mode enabled with network programming, the	 	   trip delay.  In loopback mode enabled with network programming	
	   timestamps t1 and t2 are used to measure one-way delay.	 	   function, the timestamps t1 and t2 are used to measure one-way delay.	
		 		
	8.  Security Considerations	 	9.  Security Considerations	
		 		
	   The Performance Delay and Liveness Monitoring is intended for	 	   The Performance Delay and Liveness Monitoring is intended for	
	   deployment in the well-managed private and service provider networks.	 	   deployment in the well-managed private and service provider networks.	
	   As such, it assumes that a node involved in a monitoring operation	 	   As such, it assumes that a node involved in a monitoring operation	
	   has previously verified the integrity of the path and the identity of	 	   has previously verified the integrity of the path and the identity of	
	   the reflector node.  If desired, attacks can be mitigated by	 	   the reflector node.  If desired, attacks can be mitigated by	
	   performing basic validation and sanity checks, at the sender, of the	 	   performing basic validation and sanity checks, at the sender, of the	
	   timestamp fields in received probe messages.  The minimal state	 	   timestamp fields in received probe messages.  The minimal state	
	   associated with these protocols also limits the extent of disruption	 	   associated with these protocols also limits the extent of disruption	
	   that can be caused by a corrupt or invalid message to a single probe	 	   that can be caused by a corrupt or invalid message to a single probe	
	   cycle.  Use of HMAC-SHA-256 in the authenticated mode protects the	 	   cycle.  Use of HMAC-SHA-256 in the authenticated mode protects the	
	   data integrity of the probe messages.  Cryptographic measures may be	 	   data integrity of the probe messages.  Cryptographic measures may be	
	   enhanced by the correct configuration of access-control lists and	 	   enhanced by the correct configuration of access-control lists and	
	   firewalls.	 	   firewalls.	
		 		
	9.  IANA Considerations	 	10.  IANA Considerations	
		 		
	   IANA maintains the "Special-Purpose Multiprotocol Label Switching	 	   IANA maintains the "Special-Purpose Multiprotocol Label Switching	
	   (MPLS) Label Values" registry (see <https://www.iana.org/assignments/	 	   (MPLS) Label Values" registry (see <https://www.iana.org/assignments/	
	   mpls-label-values/mpls-label-values.xml>).  IANA is requested to	 	   mpls-label-values/mpls-label-values.xml>).  IANA is requested to	
	   allocate Timestamp Label value from the "Extended Special-Purpose	 	   allocate Timestamp Label value from the "Extended Special-Purpose	
	   MPLS Label Values" registry:	 	   MPLS Label Values" registry:	
		 		
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
	       | Value       | Description                     | Reference     |	 	     | Value       | Description                     | Reference     |	
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
	       | TBA1        | Timestamp Label                 | This document |	 	     | TBA1        | Timestamp Label                 | This document |	
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
		 		
	   IANA is requested to allocate, within the "SRv6 Endpoint Behaviors	 	   IANA is requested to allocate, within the "SRv6 Endpoint Behaviors	
	   Registry" sub-registry belonging to the top-level "Segment-routing	 	   Registry" sub-registry belonging to the top-level "Segment Routing	
	   with IPv6 data plane (SRv6) Parameters" registry	 	   Parameters" registry [I-D.ietf-spring-srv6-network-programming], the	
	   [I-D.ietf-spring-srv6-network-programming], the following allocation:	 	   following allocation:	
		 		
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
	       | Value       | Endpoint Behavior               | Reference     |	 	     | Value       | Endpoint Behavior               | Reference     |	
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
	       | TBA2        | END.TSF (Timestamp and Forward) | This document |	 	     | TBA2        | End.TSF (Timestamp and Forward) | This document |	
	       +-------------+---------------------------------+---------------+	 	     +-------------+---------------------------------+---------------+	
		 		
	10.  References	 	11.  References	
		 		
	10.1.  Normative References	 	11.1.  Normative References	
		 		
	   [RFC0768]  Postel, J., "User Datagram Protocol", STD 6, RFC 768,	 	   [RFC0768]  Postel, J., "User Datagram Protocol", STD 6, RFC 768,	
	              DOI 10.17487/RFC0768, August 1980,	 	              DOI 10.17487/RFC0768, August 1980,	
	              <https://www.rfc-editor.org/info/rfc768>.	 	              <https://www.rfc-editor.org/info/rfc768>.	
		 		
	   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate	 	   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate	
	              Requirement Levels", BCP 14, RFC 2119,	 	              Requirement Levels", BCP 14, RFC 2119,	
	              DOI 10.17487/RFC2119, March 1997,	 	              DOI 10.17487/RFC2119, March 1997,	
	              <https://www.rfc-editor.org/info/rfc2119>.	 	              <https://www.rfc-editor.org/info/rfc2119>.	
		 		
		 		
	skipping to change at/page 15, line 37¶/ <#part-8>		skipping to change
at/page 17, line 19¶/ <#part-8>	
		 		
	   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC	 	   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC	
	              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,	 	              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,	
	              May 2017, <https://www.rfc-editor.org/info/rfc8174>.	 	              May 2017, <https://www.rfc-editor.org/info/rfc8174>.	
		 		
	   [RFC8762]  Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple	 	   [RFC8762]  Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple	
	              Two-Way Active Measurement Protocol", RFC 8762,	 	              Two-Way Active Measurement Protocol", RFC 8762,	
	              DOI 10.17487/RFC8762, March 2020,	 	              DOI 10.17487/RFC8762, March 2020,	
	              <https://www.rfc-editor.org/info/rfc8762>.	 	              <https://www.rfc-editor.org/info/rfc8762>.	
		 		
	10.2.  Informative References	 	11.2.  Informative References	
		 		
	   [IEEE1588]	 	   [IEEE1588]	
	              IEEE, "1588-2008 IEEE Standard for a Precision Clock	 	              IEEE, "1588-2008 IEEE Standard for a Precision Clock	
	              Synchronization Protocol for Networked Measurement and	 	              Synchronization Protocol for Networked Measurement and	
	              Control Systems", March 2008.	 	              Control Systems", March 2008.	
		 		
	   [RFC7880]  Pignataro, C., Ward, D., Akiya, N., Bhatia, M., and S.	 	   [RFC7880]  Pignataro, C., Ward, D., Akiya, N., Bhatia, M., and S.	
	              Pallagatti, "Seamless Bidirectional Forwarding Detection	 	              Pallagatti, "Seamless Bidirectional Forwarding Detection	
	              (S-BFD)", RFC 7880, DOI 10.17487/RFC7880, July 2016,	 	              (S-BFD)", RFC 7880, DOI 10.17487/RFC7880, July 2016,	
	              <https://www.rfc-editor.org/info/rfc7880>.	 	              <https://www.rfc-editor.org/info/rfc7880>.	
		 		
	skipping to change at/page 16, line 19¶/ <#part-9>		skipping to change
at/page 17, line 50¶/ <#part-9>	
		 		
	   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,	 	   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,	
	              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header	 	              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header	
	              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,	 	              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,	
	              <https://www.rfc-editor.org/info/rfc8754>.	 	              <https://www.rfc-editor.org/info/rfc8754>.	
		 		
	   [I-D.gandhi-spring-twamp-srpm]	 	   [I-D.gandhi-spring-twamp-srpm]	
	              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.	 	              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.	
	              Janssens, "Performance Measurement Using TWAMP Light for	 	              Janssens, "Performance Measurement Using TWAMP Light for	
	              Segment Routing Networks", draft-gandhi-spring-twamp-	 	              Segment Routing Networks", draft-gandhi-spring-twamp-	
	              srpm-09 (work in progress), June 2020.	 	              srpm-10 (work in progress), August 2020.	
		 		
	   [I-D.gandhi-spring-stamp-srpm]	 	   [I-D.gandhi-spring-stamp-srpm]	
	              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.	 	              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.	
	              Janssens, "Performance Measurement Using STAMP for Segment	 	              Janssens, "Performance Measurement Using Simple TWAMP	
	              Routing Networks", draft-gandhi-spring-stamp-srpm-01 (work	 	              (STAMP) for Segment Routing Networks", draft-gandhi-	
	              in progress), June 2020.	 	              spring-stamp-srpm-02 (work in progress), August 2020.	
		 		
	   [I-D.ietf-spring-segment-routing-policy]	 	   [I-D.ietf-spring-segment-routing-policy]	
	              Filsfils, C., Sivabalan, S., Voyer, D., Bogdanov, A., and	 	              Filsfils, C., Talaulikar, K., Voyer, D., Bogdanov, A., and	
	              P. Mattes, "Segment Routing Policy Architecture", draft-	 	              P. Mattes, "Segment Routing Policy Architecture", draft-	
	              ietf-spring-segment-routing-policy-07 (work in progress),	 	              ietf-spring-segment-routing-policy-08 (work in progress),	
	              May 2020.	 	              July 2020.	
		 		
	   [I-D.ietf-spring-srv6-network-programming]	 	   [I-D.ietf-spring-srv6-network-programming]	
	              Filsfils, C., Camarillo, P., Leddy, J., Voyer, D.,	 	              Filsfils, C., Camarillo, P., Leddy, J., Voyer, D.,	
	              Matsushima, S., and Z. Li, "SRv6 Network Programming",	 	              Matsushima, S., and Z. Li, "SRv6 Network Programming",	
	              draft-ietf-spring-srv6-network-programming-16 (work in	 	              draft-ietf-spring-srv6-network-programming-19 (work in	
	              progress), June 2020.	 	              progress), September 2020.	
		 		
	   [I-D.ietf-mpls-spl-terminology]	 	   [I-D.ietf-mpls-spl-terminology]	
	              Andersson, L., Kompella, K., and A. Farrel, "Special	 	              Andersson, L., Kompella, K., and A. Farrel, "Special	
	              Purpose Label terminology", draft-ietf-mpls-spl-	 	              Purpose Label terminology", draft-ietf-mpls-spl-	
	              terminology-02 (work in progress), May 2020.	 	              terminology-03 (work in progress), August 2020.	
		 		
	   [I-D.ietf-pce-binding-label-sid]	 	   [I-D.ietf-pce-binding-label-sid]	
	              Filsfils, C., Sivabalan, S., Tantsura, J., Hardwick, J.,	 	              Filsfils, C., Sivabalan, S., Tantsura, J., Hardwick, J.,	
	              Previdi, S., and C. Li, "Carrying Binding Label/Segment-ID	 	              Previdi, S., and C. Li, "Carrying Binding Label/Segment-ID	
	              in PCE-based Networks.", draft-ietf-pce-binding-label-	 	              in PCE-based Networks.", draft-ietf-pce-binding-label-	
	              sid-03 (work in progress), June 2020.	 	              sid-03 (work in progress), June 2020.	
		 		
	   [I-D.ietf-pce-sr-bidir-path]	 	   [I-D.ietf-pce-sr-bidir-path]	
	              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,	 	              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,	
	              "PCEP Extensions for Associated Bidirectional Segment	 	              "PCEP Extensions for Associated Bidirectional Segment	
	              Routing (SR) Paths", draft-ietf-pce-sr-bidir-path-02 (work	 	              Routing (SR) Paths", draft-ietf-pce-sr-bidir-path-03 (work	
	              in progress), March 2020.	 	              in progress), September 2020.	
		 		
	Acknowledgments	 	Acknowledgments	
		 		
	   TBD	 	   The authors would like to thank Greg Mirsky, Mach Chen, Kireeti	
		 	   Kompella, and Adrian Farrel for providing the review comments.	
		 		
	Authors' Addresses	 	Authors' Addresses	
		 		
	   Rakesh Gandhi (editor)	 	   Rakesh Gandhi (editor)	
	   Cisco Systems, Inc.	 	   Cisco Systems, Inc.	
	   Canada	 	   Canada	
		 		
	   Email: rgandhi@cisco.com	 	   Email: rgandhi@cisco.com	
	                                                                         	 		
	   Clarence Filsfils	 	   Clarence Filsfils	
	   Cisco Systems, Inc.	 	   Cisco Systems, Inc.	
		 		
	   Email: cfilsfil@cisco.com	 	   Email: cfilsfil@cisco.com	
		 		
	   Navin Vaghamshi	 	   Navin Vaghamshi	
	   Reliance	 	   Reliance	
		 		
	   Email: Navin.Vaghamshi@ril.com	 	   Email: Navin.Vaghamshi@ril.com	
		 		
		 		
 End of changes. 73 change blocks. 
	/240 lines changed or deleted/	//	/307 lines changed or added/	

This html diff was produced by rfcdiff 1.48. The latest version is available from http://tools.ietf.org/tools/rfcdiff/ <http://www.tools.ietf.org/tools/rfcdiff/> 

