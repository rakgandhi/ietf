<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC0768 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.0768.xml">
<!ENTITY RFC2119 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4656 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4656.xml">
<!ENTITY RFC5357 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5357.xml">
<!ENTITY RFC8174 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC2104 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2104.xml">
<!ENTITY RFC2113 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2113.xml">
<!ENTITY RFC4868 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4868.xml">
<!ENTITY RFC5884 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5884.xml">
<!ENTITY RFC6038 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6038.xml">
<!ENTITY RFC6335 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6335.xml">
<!ENTITY RFC6437 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6437.xml">
<!ENTITY RFC6936 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6936.xml">
<!ENTITY RFC7506 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7506.xml">
<!ENTITY RFC7820 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7820.xml">
<!ENTITY RFC8029 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8029.xml">
<!ENTITY RFC8085 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8085.xml">
<!ENTITY RFC8186 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8186.xml">
<!ENTITY RFC8321 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8321.xml">
<!ENTITY RFC8402 SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml">
<!ENTITY I-D.ietf-spring-segment-routing-policy SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-spring-segment-routing-policy.xml">
<!ENTITY I-D.ietf-spring-mpls-path-segment SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-spring-mpls-path-segment.xml">
<!ENTITY I-D.ietf-6man-segment-routing-header SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-6man-segment-routing-header.xml">
<!ENTITY I-D.ietf-pce-binding-label-sid SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-pce-binding-label-sid.xml">
<!ENTITY I-D.li-pce-sr-bidir-path SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.li-pce-sr-bidir-path.xml">
<!ENTITY I-D.gandhi-spring-twamp-srpm SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.gandhi-spring-twamp-srpm.xml">
<!ENTITY I-D.ietf-spring-srv6-network-programming SYSTEM "https://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-spring-srv6-network-programming.xml">
]>
<rfc category="std" docName="draft-gandhi-spring-sr-enhanced-plm-00"
     ipr="trust200902" submissionType="IETF">
  <!-- Generated by id2xml 1.5.0 on 2020-02-06T01:41:26Z -->

  <?rfc compact="yes"?>

  <?rfc text-list-symbols="oo*+-"?>

  <?rfc subcompact="no"?>

  <?rfc sortrefs="no"?>

  <?rfc symrefs="yes"?>

  <?rfc strict="yes"?>

  <?rfc toc="yes"?>

  <front>
    <title abbrev="Performance and Liveness Monitoring in SR">Enhanced
    Performance and Liveness Monitoring in Segment Routing Networks</title>

    <author fullname="Rakesh Gandhi" initials="R." role="editor"
            surname="Gandhi">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>Canada</street>
        </postal>

        <email>rgandhi@cisco.com</email>
      </address>
    </author>

    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <email>cfilsfil@cisco.com</email>
      </address>
    </author>

    <author fullname="Daniel Voyer" initials="D." surname="Voyer (TBD)">
      <organization>Bell Canada</organization>

      <address>
        <email>daniel.voyer@bell.ca</email>
      </address>
    </author>

    <author fullname="MC" initials="M." surname="C (TBD)">
      <organization>H</organization>

      <address>
        <email>mc@h.com</email>
      </address>
    </author>

    <author fullname="Bart Janssens" initials="B." surname="Janssens (TBD)">
      <organization>Colt</organization>

      <address>
        <email>Bart.Janssens@colt.net</email>
      </address>
    </author>

    <date day="6" month="February" year="2020"/>

    <workgroup>SPRING Working Group</workgroup>

    <abstract>
      <t>Segment Routing (SR) leverages the source routing paradigm. SR is
      applicable to both Multiprotocol Label Switching (SR-MPLS) and IPv6
      (SRv6) data planes. This document defines procedure for Enhanced
      Performance and Liveness Monitoring (PLM) in Segment Routing networks.
      The procedure uses the probe messages defined in RFC 5357 (Two-Way
      Active Measurement Protocol (TWAMP) Light). The procedure specified is
      applicable to both SR-MPLS and SRv6 data planes.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="sect-1" title="Introduction">
      <t>Segment Routing (SR) leverages the source routing paradigm and
      greatly simplifies network operations for Software Defined Networks
      (SDNs). SR is applicable to both Multiprotocol Label Switching (SR-MPLS)
      and IPv6 (SRv6) data planes. SR takes advantage of the Equal-Cost
      Multipaths (ECMPs) between source and transit nodes, between transit
      nodes and between transit and destination nodes. SR Policies as defined
      in <xref format="default"
      target="I-D.ietf-spring-segment-routing-policy"/>are used to steer
      traffic through a specific, user-defined paths using a stack of
      Segments. Built-in Liveness Monitoring for detecting faults as well as
      Performance Delay and Loss Monitoring are essential requirements to
      provide Service Level Agreements (SLAs) in SR networks.</t>

      <t>The One-Way Active Measurement Protocol (OWAMP) defined in <xref
      target="RFC4656"/>and Two-Way Active Measurement Protocol (TWAMP)
      defined in <xref target="RFC5357"/>provide capabilities for the
      measurement of various performance metrics in IP networks using probe
      messages. The TWAMP Light [Appendix I in RFC 5357] provides simplified
      mechanisms for active performance measurement in Customer IP networks by
      provisioning UDP paths that eliminates the control-channel
      signaling.</t>

      <t>This document defines procedure for Enhanced Performance and Liveness
      Monitoring (PLM) in Segment Routing networks. The procedure uses the
      probe messages defined in <xref target="RFC5357"/>(Two-Way Active
      Measurement Protocol (TWAMP) Light) in loopback mode. The procedure
      specified is applicable to both SR-MPLS and SRv6 data planes.</t>
    </section>

    <section anchor="sect-2" title="Conventions Used in This Document">
      <section anchor="sect-2.1" title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
        appear in all capitals, as shown here.</t>
      </section>

      <section anchor="sect-2.2" title="Abbreviations">
        <t>BSID: Binding Segment ID.</t>

        <t>DM: Delay Measurement.</t>

        <t>ECMP: Equal Cost Multi-Path.</t>

        <t>LM: Loss Measurement.</t>

        <t>MPLS: Multiprotocol Label Switching.</t>

        <t>NTP: Network Time Protocol.</t>

        <t>OWAMP: One-Way Active Measurement Protocol.</t>

        <t>PM: Performance Measurement.</t>

        <t>PTP: Precision Time Protocol.</t>

        <t>SID: Segment ID.</t>

        <t>SL: Segment List.</t>

        <t>SR: Segment Routing.</t>

        <t>SRH: Segment Routing Header.</t>

        <t>SR-MPLS: Segment Routing with MPLS data plane.</t>

        <t>SRv6: Segment Routing with IPv6 data plane.</t>

        <t>TC: Traffic Class.</t>

        <t>TWAMP: Two-Way Active Measurement Protocol.</t>
      </section>
    </section>

    <section anchor="sect-3" title="Liveness Monitoring">
      <t>For liveness monitoring for an SR Policy, the loopback mode as
      defined in <xref target="I-D.gandhi-spring-twamp-srpm"/> is used. The
      TWAMP probe messages for delay measurement defined in <xref
      target="RFC5357"/> are sent by the head-end sender node to the endpoint
      node of the SR Policy using the Segment Lists of the SR Policy. The
      Source and destination IP addresses in the probe packets are set to the
      endpoint node and the sender node. The probe packets are received back
      by the sender node via IP return path. The Segment List of the return
      path can be added in the probe message header to receive the probe
      message on a specific SR path.</t>

      <t>Liveness failure is notified when N number of consecutive probe
      messages are not received back at the sender, where N is locally
      provisioned.</t>

      <figure anchor="ure-loopback-mode" title="Loopback Mode">
        <artwork>
               +-------+       Probe         +-------+
               |       | - - - - - - - - - - |       |
               |   R1  |--------------------||  R5   |
               |       |&lt;- - - - - - - - - - |       |
               +-------+     Return Probe    +-------+
                Sender                       Endpoint
                                             (Forword)
       </artwork>
      </figure>

      <section anchor="sect-3.1" title="Loopback Mode for SR-MPLS">
        <t>Lopback Mode for SR-MPLS TBD</t>

        <figure anchor="ure-probe-message-header-for-sr-mpls"
                title="Probe Message Header For SR-MPLS">
          <artwork>  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Segment(1)             | TC  |S|      TTL      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  .                                                               .
  .                                                               .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Segment(n)             | TC  |S|      TTL      |
  +---------------------------------------------------------------+
  | IP Header                                                     |
  .  Source IP Address = Endpoint IPv4 or IPv6 Address            .
  .  Destination IP Address = Sender IPv4 or IPv6 Address         .
  .  Protocol = UDP                                               .
  .                                                               .
  +---------------------------------------------------------------+
  | UDP Header                                                    |
  .  Source Port = As chosen by Sender                            .
  .  Destination Port = User-configured Port                      .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   RFC 5357 Message in Payload                                 |
  .                                                               .
  +---------------------------------------------------------------+</artwork>
        </figure>
      </section>

      <section anchor="sect-3.2" title="Loopback Mode for SRv6">
        <t>Lopback Mode for SRv6 TBD</t>

        <figure anchor="ure-probe-message-header-for-srv6"
                title="Probe Message Header for SRv6">
          <artwork>  
  +---------------------------------------------------------------+
  |                           SRH                                 |
  .                           &lt;Segment List&gt;                      .
  .                                                               .
  +---------------------------------------------------------------+
  | IP Header                                                     |
  .  Source IP Address = Endpoint IPv6 Address                    .
  .  Destination IP Address = Sender IPv6 Address                 .
  .  Protocol = UDP                                               .
  .                                                               .
  +---------------------------------------------------------------+
  | UDP Header                                                    |
  .  Source Port = As chosen by Sender                            .
  .  Destination Port = User-configured Port                      .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   RFC 5357 Message in Payload                                 |
  .                                                               .
  +---------------------------------------------------------------+</artwork>
        </figure>
      </section>
    </section>

    <section anchor="sect-4"
             title="Enhanced Performance and Liveness Monitoring">
      <t>The enhanced performance and liveness monitoring for an SR Policy is
      defined using loopback mode with network programming. In this mode, both
      transmit and receive timestamps are collected in data plane by the probe
      messages sent in loopback mode enabled with network programming
      function. The endpoint node returns the receive timestamp in the payload
      of the TWAMP probe message without punting the probe message in
      control-plane. The end-to-end delay is measured using the receive and
      transmit timestamps in the probe message. Liveness failure is notified
      when N number of consecutive probe messages are not received back at the
      sender, where N is locally provisioned.</t>

      <figure anchor="ure-loopback-mode-with-network-programming"
              title="Loopback Mode with Network Programming">
        <artwork>
               +-------+       Probe         +-------+
               |       | - - - - - - - - - - |       |
               |   R1  |--------------------||  R5   |
               |       |&lt;- - - - - - - - - - |       |
               +-------+     Return Probe    +-------+
                Sender                       Endpoint
                                             (Timestamp and Forward)
      </artwork>
      </figure>

      <section anchor="sect-4.1"
               title="Loopback Mode with Network Programming for SR-MPLS"
               toc="default">
        <t>In the loopback mode with network programming for SR-MPLS, a
        timestamp label (reserved label TBD1) is added in the MPLS header to
        collect receive timestamp in the payload of the TWAMP <xref
        target="RFC5357"/>probe packet at a specific location locally
        provisioned. When a node receives a packet with timestamp label, the
        node pops the timestamp label and forwards the packet using the next
        label or IP header in the packet, in addition to adding the
        timestamp.</t>

        <figure anchor="ure-probe-message-header-for-sr-mpls-with-timestamp-label"
                title="Probe Message Header For SR-MPLS with Timestamp Label">
          <artwork>
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Segment(1)             | TC  |S|      TTL      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  .                                                               .
  .                                                               .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Segment(n)             | TC  |S|      TTL      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                Timestamp Label (TBA1) | TC  |S|      TTL      |
  +---------------------------------------------------------------+
  | IP Header                                                     |
  .  Source IP Address = Endpoint IPv4 or IPv6 Address            .
  .  Destination IP Address = Sender IPv4 or IPv6 Address         .
  .  Protocol = UDP                                               .
  .                                                               .
  +---------------------------------------------------------------+
  | UDP Header                                                    |
  .  Source Port = As chosen by Sender                            .
  .  Destination Port = User-configured Port                      .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   RFC 5357 Message in Payload                                 |
  .                                                               .
  +---------------------------------------------------------------+</artwork>
        </figure>
      </section>

      <section anchor="sect-4.2"
               title="Loopback Mode with Network Programming for SRv6">
        <t>In the loopback mode with network programming for SRv6, END.OTS
        function (OAM Timestamp, value TBD2) is added for the Endpoint SID in
        SRH <xref target="I-D.ietf-6man-segment-routing-header"/>to collect
        receive timestamp in the payload of the TWAMP <xref
        target="RFC5357"/>probe packet at a specific location locally
        provisioned. When a node receives a packet with END.OTS function, the
        node forwards the packet using the next SID or IP header in the
        packet, in addition to adding the timestamp.</t>

        <figure anchor="ure-probe-message-header-for-srv6-with-endpoint-function"
                title="Probe Message Header for SRv6 With Endpoint Function">
          <artwork>
  +---------------------------------------------------------------+
  |                           SRH                                 |
  .                      &lt;Segment List&gt;                           .
  .   END.OTS (TBA2) with Target SRv6 SID                         .
  +---------------------------------------------------------------+
  | IP Header                                                     |
  .  Source IP Address = Endpoint IPv6 Address                    .
  .  Destination IP Address = Sender IPv6 Address                 .
  .  Protocol = UDP                                               .
  .                                                               .
  +---------------------------------------------------------------+
  | UDP Header                                                    |
  .  Source Port = As chosen by Sender                            .
  .  Destination Port = User-configured Port                      .
  .                                                               .
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   RFC 5357 Message in Payload                                 |
  .                                                               .
  +---------------------------------------------------------------+</artwork>
        </figure>
      </section>
    </section>

    <section anchor="sect-5" title="Security Considerations" toc="default">
      <t>TBA</t>
    </section>

    <section anchor="sect-7" title="IANA Considerations" toc="default">
      <t>IANA maintains the "Special-Purpose Multiprotocol Label Switching
      (MPLS) Label Values" registry (see
      &lt;https://www.iana.org/assignments/mpls-label-values/mpls-label-
      values.xml&gt;). IANA is requested to allocate Timestamp Label value
      from the "Extended Special-Purpose MPLS Label Values" registry:</t>

      <figure>
        <artwork>
    +-------------+-------------------------+---------------+
    | Value       | Description             | Reference     |
    +-------------+-------------------------+---------------+
    | TBA1        | Timestamp Label         | This document |
    +-------------+-------------------------+---------------+
      </artwork>
      </figure>

      <t>IANA is requested to allocate, within the "SRv6 Endpoint Behaviors
      Registry" sub-registry belonging to the top-level "Segment- routing with
      IPv6 data plane (SRv6) Parameters" registry <xref
      target="I-D.ietf-spring-srv6-network-programming"/>, the following
      allocations.</t>

      <figure>
        <artwork>     
     +------------+-------------------------+---------------+
     | Value      | Endpoint Behavior       | Reference     |
     +------------+-------------------------+---------------+
     | TBA2       | End.OTS (OAM Timestamp) | This document |
     +------------+-------------------------+---------------+</artwork>
      </figure>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      &RFC0768;

      &RFC2119;

      &RFC4656;

      &RFC5357;

      &RFC8174;
    </references>

    <references title="Informative References">
      <reference anchor="IEEE1588">
        <front>
          <title>1588-2008 IEEE Standard for a Precision Clock Synchronization
          Protocol for Networked Measurement and Control Systems</title>

          <author>
            <organization>IEEE</organization>
          </author>

          <date month="March" year="2008"/>
        </front>
      </reference>

      &RFC5884;

      &RFC6335;

      &RFC8085;

      &RFC8186;

      &RFC8402;

      &I-D.ietf-spring-segment-routing-policy;

      &I-D.ietf-6man-segment-routing-header;

      &I-D.ietf-pce-binding-label-sid;

      &I-D.li-pce-sr-bidir-path;

      &I-D.gandhi-spring-twamp-srpm;

      &I-D.ietf-spring-srv6-network-programming;
    </references>

    <section anchor="acknowledgments" numbered="no" title="Acknowledgments">
      <t>TBD</t>
    </section>
  </back>
</rfc>
